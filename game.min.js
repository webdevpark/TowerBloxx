// Built with IMPACT - impactjs.org

Number.prototype.map=function(istart,istop,ostart,ostop){return ostart+(ostop-ostart)*((this-istart)/(istop-istart));};Number.prototype.limit=function(min,max){return Math.min(max,Math.max(min,this));};Number.prototype.round=function(precision){precision=Math.pow(10,precision||0);return Math.round(this*precision)/precision;};Number.prototype.floor=function(){return Math.floor(this);};Number.prototype.ceil=function(){return Math.ceil(this);};Number.prototype.toInt=function(){return(this|0);};Array.prototype.erase=function(item){for(var i=this.length;i--;i){if(this[i]===item)this.splice(i,1);}
return this;};Array.prototype.random=function(){return this[(Math.random()*this.length).floor()];};Function.prototype.bind=function(bind){var self=this;return function(){var args=Array.prototype.slice.call(arguments);return self.apply(bind||null,args);};};(function(window){window.ig={game:null,version:'1.15',global:window,modules:{},resources:[],ready:false,baked:false,nocache:'',ua:{},lib:'lib/',_current:null,_loadQueue:[],_waitForOnload:0,$:function(selector){return selector.charAt(0)=='#'?document.getElementById(selector.substr(1)):document.getElementsByTagName(selector);},$new:function(name){return document.createElement(name);},copy:function(object){if(!object||typeof(object)!='object'||object instanceof HTMLElement){return object;}
else if(object instanceof Array){var c=[];for(var i=0,l=object.length;i<l;i++){c[i]=ig.copy(object[i]);}
return c;}
else{var c={};for(var i in object){c[i]=ig.copy(object[i]);}
if(object instanceof ig.Class){c.__proto__=object.__proto__;}
return c;}},merge:function(original,extended){for(var key in extended){if(typeof(extended[key])=='object'&&!(extended[key]instanceof HTMLElement)){if(!original[key]||typeof(original[key])!='object'){original[key]={};}
ig.merge(original[key],extended[key]);}
else{original[key]=extended[key];}}
return original;},ksort:function(obj){if(!obj||typeof(obj)!='object'){return[];}
var keys=[],values=[];for(var i in obj){keys.push(i);}
keys.sort();for(var i=0;i<keys.length;i++){values.push(obj[keys[i]]);}
return values;},module:function(name){if(ig._current){throw("Module '"+ig._current.name+"' defines nothing");}
ig._current={name:name,requires:[],loaded:false,body:null};ig.modules[name]=ig._current;ig._loadQueue.push(ig._current);ig._initDOMReady();return ig;},requires:function(){ig._current.requires=Array.prototype.slice.call(arguments);return ig;},defines:function(body){name=ig._current.name;ig._current.body=body;ig._current=null;ig._execModules();},addResource:function(resource){ig.resources.push(resource);},setNocache:function(set){ig.nocache=set?'?'+Math.random().toString().substr(2):'';},_loadScript:function(name,requiredFrom){ig.modules[name]={name:name,requires:[],loaded:false,body:null};ig._waitForOnload++;var path=ig.lib+name.replace(/\./g,'/')+'.js'+ig.nocache;var script=ig.$new('script');script.type='text/javascript';script.src=path;script.onload=function(){ig._waitForOnload--;ig._execModules();};script.onerror=function(){throw('Failed to load module '+name+' at '+path+' '+'required from '+requiredFrom);};ig.$('head')[0].appendChild(script);},_execModules:function(){var modulesLoaded=false;for(var i=0;i<ig._loadQueue.length;i++){var m=ig._loadQueue[i];var dependenciesLoaded=true;for(var j=0;j<m.requires.length;j++){var name=m.requires[j];if(!ig.modules[name]){dependenciesLoaded=false;ig._loadScript(name,m.name);}
else if(!ig.modules[name].loaded){dependenciesLoaded=false;}}
if(dependenciesLoaded&&m.body){ig._loadQueue.splice(i,1);m.loaded=true;m.body();modulesLoaded=true;i--;}}
if(modulesLoaded){ig._execModules();}
else if(!ig.baked&&ig._waitForOnload==0&&ig._loadQueue.length!=0){var unresolved=[];for(var i=0;i<ig._loadQueue.length;i++){unresolved.push(ig._loadQueue[i].name);}
throw('Unresolved (circular?) dependencies: '+unresolved.join(', '));}},_DOMReady:function(){if(!ig.modules['dom.ready'].loaded){if(!document.body){return setTimeout(ig._DOMReady,13);}
ig.modules['dom.ready'].loaded=true;ig._waitForOnload--;ig._execModules();}
return 0;},_boot:function(){if(document.location.href.match(/\?nocache/)){ig.setNocache(true);}
ig.ua.pixelRatio=window.devicePixelRatio||1;ig.ua.viewport={width:window.innerWidth,height:window.innerHeight,};ig.ua.screen={width:window.screen.availWidth*ig.ua.pixelRatio,height:window.screen.availHeight*ig.ua.pixelRatio};ig.ua.iPhone=/iPhone/i.test(navigator.userAgent);ig.ua.iPhone4=(ig.ua.iPhone&&ig.ua.pixelRatio==2);ig.ua.iPad=/iPad/i.test(navigator.userAgent);ig.ua.android=/android/i.test(navigator.userAgent);ig.ua.iOS=ig.ua.iPhone||ig.ua.iPad;ig.ua.mobile=ig.ua.iOS||ig.ua.android;},_initDOMReady:function(){if(ig.modules['dom.ready']){return;}
ig._boot();ig.modules['dom.ready']={requires:[],loaded:false,body:null};ig._waitForOnload++;if(document.readyState==='complete'){ig._DOMReady();}
else{document.addEventListener('DOMContentLoaded',ig._DOMReady,false);window.addEventListener('load',ig._DOMReady,false);}},};var initializing=false,fnTest=/xyz/.test(function(){xyz;})?/\bparent\b/:/.*/;window.ig.Class=function(){};window.ig.Class.extend=function(prop){var parent=this.prototype;initializing=true;var prototype=new this();initializing=false;for(var name in prop){if(typeof(prop[name])=="function"&&typeof(parent[name])=="function"&&fnTest.test(prop[name])){prototype[name]=(function(name,fn){return function(){var tmp=this.parent;this.parent=parent[name];var ret=fn.apply(this,arguments);this.parent=tmp;return ret;};})(name,prop[name])}
else{prototype[name]=prop[name];}}
function Class(){if(!initializing){if(this.staticInstantiate){var obj=this.staticInstantiate.apply(this,arguments);if(obj){return obj;}}
for(p in this){this[p]=ig.copy(this[p]);}
if(this.init){this.init.apply(this,arguments);}}
return this;}
Class.prototype=prototype;Class.constructor=Class;Class.extend=arguments.callee;return Class;};})(window);

// lib/impact/image.js
ig.baked=true;ig.module('impact.image').defines(function(){ig.Image=ig.Class.extend({data:null,width:0,height:0,loaded:false,failed:false,loadCallback:null,path:'',staticInstantiate:function(path){return ig.Image.cache[path]||null;},init:function(path){this.path=path;this.load();},load:function(loadCallback){if(this.loaded){if(loadCallback){loadCallback(this.path,true);}
return;}
else if(!this.loaded&&ig.ready){this.loadCallback=loadCallback||null;this.data=new Image();this.data.onload=this.onload.bind(this);this.data.onerror=this.onerror.bind(this);this.data.src=this.path+ig.nocache;}
else{ig.addResource(this);}
ig.Image.cache[this.path]=this;},reload:function(){this.loaded=false;this.data=new Image();this.data.onload=this.onload.bind(this);this.data.src=this.path+'?'+Math.random();},onload:function(event){this.width=this.data.width;this.height=this.data.height;if(ig.system.scale!=1){this.resize(ig.system.scale);}
this.loaded=true;if(this.loadCallback){this.loadCallback(this.path,true);}},onerror:function(event){this.failed=true;if(this.loadCallback){this.loadCallback(this.path,false);}},resize:function(scale){var widthScaled=this.width*scale;var heightScaled=this.height*scale;var orig=ig.$new('canvas');orig.width=this.width;orig.height=this.height;var origCtx=orig.getContext('2d');origCtx.drawImage(this.data,0,0,this.width,this.height,0,0,this.width,this.height);var origPixels=origCtx.getImageData(0,0,this.width,this.height);var scaled=ig.$new('canvas');scaled.width=widthScaled;scaled.height=heightScaled;var scaledCtx=scaled.getContext('2d');var scaledPixels=scaledCtx.getImageData(0,0,widthScaled,heightScaled);for(var y=0;y<heightScaled;y++){for(var x=0;x<widthScaled;x++){var index=((y/scale).floor()*this.width+(x/scale).floor())*4;var indexScaled=(y*widthScaled+x)*4;scaledPixels.data[indexScaled]=origPixels.data[index];scaledPixels.data[indexScaled+1]=origPixels.data[index+1];scaledPixels.data[indexScaled+2]=origPixels.data[index+2];scaledPixels.data[indexScaled+3]=origPixels.data[index+3];}}
scaledCtx.putImageData(scaledPixels,0,0);this.data=scaled;},draw:function(targetX,targetY,sourceX,sourceY,width,height){if(!this.loaded){return;}
var scale=ig.system.scale;sourceX=sourceX?sourceX*scale:0;sourceY=sourceY?sourceY*scale:0;width=(width?width:this.width)*scale;height=(height?height:this.height)*scale;ig.system.context.drawImage(this.data,sourceX,sourceY,width,height,ig.system.getDrawPos(targetX),ig.system.getDrawPos(targetY),width,height);},drawTile:function(targetX,targetY,tile,tileWidth,tileHeight,flipX,flipY){tileHeight=tileHeight?tileHeight:tileWidth;if(!this.loaded||tileWidth>this.width||tileHeight>this.height){return;}
var scale=ig.system.scale;var tileWidthScaled=tileWidth*scale;var tileHeightScaled=tileHeight*scale;var scaleX=flipX?-1:1;var scaleY=flipY?-1:1;if(flipX||flipY){ig.system.context.save();ig.system.context.scale(scaleX,scaleY);}
ig.system.context.drawImage(this.data,((tile*tileWidth).floor()%this.width)*scale,((tile*tileWidth/this.width).floor()*tileHeight)*scale,tileWidthScaled,tileHeightScaled,ig.system.getDrawPos(targetX)*scaleX-(flipX?tileWidthScaled:0),ig.system.getDrawPos(targetY)*scaleY-(flipY?tileHeightScaled:0),tileWidthScaled,tileHeightScaled);if(flipX||flipY){ig.system.context.restore();}}});ig.Image.cache={};ig.Image.reloadCache=function(){for(path in ig.Image.cache){ig.Image.cache[path].reload();}};});

// lib/impact/font.js
ig.baked=true;ig.module('impact.font').requires('impact.image').defines(function(){ig.Font=ig.Image.extend({widthMap:[],indices:[],firstChar:32,onload:function(ev){this._loadMetrics(this.data);this.parent(ev);},draw:function(text,x,y,align){if(typeof(text)!='string'){text=text.toString();}
if(align==ig.Font.ALIGN.RIGHT||align==ig.Font.ALIGN.CENTER){var width=0;for(var i=0;i<text.length;i++){var c=text.charCodeAt(i);width+=this.widthMap[c-this.firstChar]+1;}
x-=align==ig.Font.ALIGN.CENTER?width/2:width;}
for(var i=0;i<text.length;i++){var c=text.charCodeAt(i);x+=this._drawChar(c-this.firstChar,x,y);}},_drawChar:function(c,targetX,targetY){if(!this.loaded||c<0||c>=this.indices.length){return 0;}
var scale=ig.system.scale;var charX=this.indices[c]*scale;var charY=0;var charWidth=this.widthMap[c]*scale;var charHeight=(this.height-2)*scale;ig.system.context.drawImage(this.data,charX,charY,charWidth,charHeight,ig.system.getDrawPos(targetX),ig.system.getDrawPos(targetY),charWidth,charHeight);return this.widthMap[c]+1;},_loadMetrics:function(image){this.widthMap=[];this.indices=[];var canvas=ig.$new('canvas');canvas.width=image.width;canvas.height=1;var ctx=canvas.getContext('2d');ctx.drawImage(image,0,image.height-1,image.width,1,0,0,image.width,1);var px=ctx.getImageData(0,0,image.width,1);var currentChar=0;var currentWidth=0;for(var x=0;x<image.width;x++){var index=x*4+3;if(px.data[index]!=0){currentWidth++;}
else if(px.data[index]==0&&currentWidth){this.widthMap.push(currentWidth);this.indices.push(x-currentWidth);currentChar++;currentWidth=0;}}
this.widthMap.push(currentWidth);this.indices.push(x-currentWidth);}});ig.Font.ALIGN={LEFT:0,RIGHT:1,CENTER:2};});

// lib/impact/sound.js
ig.baked=true;ig.module('impact.sound').defines(function(){ig.SoundManager=ig.Class.extend({clips:{},volume:1,channels:4,format:'mp3',init:function(){this.format=ig.$new('audio').canPlayType('audio/mpeg')?'mp3':'ogg';},load:function(path,multiChannel,loadCallback){if(this.clips[path]){if(multiChannel&&this.clips[path].length<this.channels){for(var i=this.clips[path].length;i<this.channels;i++){this.clips[path].push(this.clips[path][0].cloneNode(true));}}
return this.clips[path][0];}
var realPath=path.match(/^(.*)\.\w+$/)[1]+'.'+this.format+ig.nocache;var clip=ig.$new('audio');if(loadCallback){clip.addEventListener('canplaythrough',function(ev){this.removeEventListener('canplaythrough',arguments.callee,false)
loadCallback(path,true,ev);},false);clip.addEventListener('error',function(ev){loadCallback(path,true,ev);},false);}
clip.autobuffer=true;clip.preload='auto';clip.src=realPath;clip.load();this.clips[path]=[clip];if(multiChannel){for(var i=1;i<this.channels;i++){this.clips[path].push(clip.cloneNode(true));}}
return clip;},get:function(path){var channels=this.clips[path];for(var i=0,clip;clip=channels[i++];){if(clip.paused||clip.ended){if(clip.ended){clip.currentTime=0;}
return clip;}}
channels[0].pause();channels[0].currentTime=0;return channels[0];}});ig.Music=ig.Class.extend({tracks:[],currentTrack:null,currentIndex:0,random:false,_volume:1,_loop:false,_fadeInterval:0,_fadeTimer:null,_endedCallbackBound:null,init:function(){this._endedCallbackBound=this._endedCallback.bind(this);if(Object.defineProperty){Object.defineProperty(this,"volume",{get:this.getVolume.bind(this),set:this.setVolume.bind(this)});Object.defineProperty(this,"loop",{get:this.getLooping.bind(this),set:this.setLooping.bind(this)});}
else if(this.__defineGetter__){this.__defineGetter__('volume',this.getVolume.bind(this));this.__defineSetter__('volume',this.setVolume.bind(this));this.__defineGetter__('loop',this.getLooping.bind(this));this.__defineSetter__('loop',this.setLooping.bind(this));}},add:function(music){if(!ig.Sound.enabled){return;}
var path=music instanceof ig.Sound?music.path:music;var track=ig.soundManager.load(path,false);track.loop=this._loop;track.volume=this._volume;track.addEventListener('ended',this._endedCallbackBound,false);this.tracks.push(track);if(!this.currentTrack){this.currentTrack=track;}},next:function(){if(!this.tracks.length){return;}
this.stop();this.currentIndex=this.random?(Math.random()*this.tracks.length).floor():(this.currentIndex+1)%this.tracks.length;this.currentTrack=this.tracks[this.currentIndex];this.play();},pause:function(){if(!this.currentTrack){return;}
this.currentTrack.pause();},stop:function(){if(!this.currentTrack){return;}
this.currentTrack.pause();this.currentTrack.currentTime=0;},play:function(){if(!this.currentTrack){return;}
this.currentTrack.play();},getLooping:function(){return this._loop;},setLooping:function(l){this._loop=l;for(var i in this.tracks){this.tracks[i].loop=l;}},getVolume:function(){return this._volume;},setVolume:function(v){this._volume=v.limit(0,1);for(var i in this.tracks){this.tracks[i].volume=this._volume;}},fadeOut:function(time){if(!this.currentTrack){return;}
clearInterval(this._fadeInterval);this.fadeTimer=new ig.Timer(time);this._fadeInterval=setInterval(this._fadeStep.bind(this),50);},_fadeStep:function(){var v=this.fadeTimer.delta().map(-this.fadeTimer.target,0,1,0).limit(0,1)*this._volume;if(v<=0.01){this.stop();this.currentTrack.volume=this._volume;clearInterval(this._fadeInterval);}
else{this.currentTrack.volume=v;}},_endedCallback:function(){if(this._loop){this.play();}
else{this.next();}}});ig.Sound=ig.Class.extend({path:'',volume:1,currentClip:null,multiChannel:true,init:function(path,multiChannel){this.path=path;this.multiChannel=(multiChannel!==false);this.load();},load:function(loadCallback){if(!ig.Sound.enabled){if(loadCallback){loadCallback(this.path,true);}
return;}
if(ig.ready){ig.soundManager.load(this.path,this.multiChannel,loadCallback);}
else{ig.addResource(this);}},play:function(){if(!ig.Sound.enabled){return;}
this.currentClip=ig.soundManager.get(this.path);this.currentClip.volume=ig.soundManager.volume*this.volume;this.currentClip.play();},stop:function(){if(this.currentClip){this.currentClip.pause();this.currentClip.currentTime=0;}}});ig.Sound.enabled=true;});

// lib/impact/loader.js
ig.baked=true;ig.module('impact.loader').requires('impact.image','impact.font','impact.sound').defines(function(){ig.Loader=ig.Class.extend({resources:[],gameClass:null,status:0,done:false,_unloaded:[],_drawStatus:0,_intervalId:0,_loadCallbackBound:null,init:function(gameClass,resources){this.gameClass=gameClass;this.resources=resources;this._loadCallbackBound=this._loadCallback.bind(this);for(var i=0;i<this.resources.length;i++){this._unloaded.push(this.resources[i].path);}},load:function(){ig.system.clear('#000');if(!this.resources.length){this.end();return;}
for(var i=0;i<this.resources.length;i++){this.loadResource(this.resources[i]);}
this._intervalId=setInterval(this.draw.bind(this),16);},loadResource:function(res){res.load(this._loadCallbackBound);},end:function(){if(this.done){return;}
this.done=true;clearInterval(this._intervalId);ig.system.setGame(this.gameClass);},draw:function(){this._drawStatus+=(this.status-this._drawStatus)/5;var s=ig.system.scale;var w=ig.system.width*0.6;var h=ig.system.height*0.1;var x=ig.system.width*0.5-w/2;var y=ig.system.height*0.5-h/2;ig.system.context.fillStyle='#000';ig.system.context.fillRect(0,0,480,320);ig.system.context.fillStyle='#fff';ig.system.context.fillRect(x*s,y*s,w*s,h*s);ig.system.context.fillStyle='#000';ig.system.context.fillRect(x*s+s,y*s+s,w*s-s-s,h*s-s-s);ig.system.context.fillStyle='#fff';ig.system.context.fillRect(x*s,y*s,w*s*this._drawStatus,h*s);},_loadCallback:function(path,status){if(status){this._unloaded.erase(path);}
else{throw('Failed to load resource: '+path);}
this.status=1-(this._unloaded.length/this.resources.length);if(this._unloaded.length==0){setTimeout(this.end.bind(this),250);}}});});

// lib/impact/timer.js
ig.baked=true;ig.module('impact.timer').defines(function(){ig.Timer=ig.Class.extend({target:0,base:0,last:0,init:function(seconds){this.base=ig.Timer.time;this.last=ig.Timer.time;this.target=seconds||0;},set:function(seconds){this.target=seconds||0;this.base=ig.Timer.time;},reset:function(){this.base=ig.Timer.time;},tick:function(){var delta=ig.Timer.time-this.last;this.last=ig.Timer.time;return delta;},delta:function(){return ig.Timer.time-this.base-this.target;}});ig.Timer._last=0;ig.Timer.time=0;ig.Timer.timeScale=1;ig.Timer.maxStep=0.05;ig.Timer.step=function(){var current=Date.now();var delta=(current-ig.Timer._last)/1000;ig.Timer.time+=Math.min(delta,ig.Timer.maxStep)*ig.Timer.timeScale;ig.Timer._last=current;};});

// lib/impact/system.js
ig.baked=true;ig.module('impact.system').requires('impact.timer','impact.image').defines(function(){ig.System=ig.Class.extend({fps:30,width:320,height:240,realWidth:320,realHeight:240,scale:1,tick:0,intervalId:0,newGameClass:null,running:false,delegate:null,clock:null,canvas:null,context:null,smoothPositioning:true,init:function(canvasId,fps,width,height,scale){this.fps=fps;this.width=width;this.height=height;this.scale=scale;this.realWidth=width*scale;this.realHeight=height*scale;this.clock=new ig.Timer();this.canvas=ig.$(canvasId);this.canvas.width=this.realWidth;this.canvas.height=this.realHeight;this.context=this.canvas.getContext('2d');},setGame:function(gameClass){if(this.running){this.newGameClass=gameClass;}
else{this.setGameNow(gameClass);}},setGameNow:function(gameClass){ig.game=new(gameClass)();ig.system.setDelegate(ig.game);},setDelegate:function(object){if(typeof(object.run)=='function'){this.delegate=object;this.startRunLoop();}else{throw('System.setDelegate: No run() function in object');}},stopRunLoop:function(){clearInterval(this.intervalId);this.running=false;},startRunLoop:function(){this.stopRunLoop();this.intervalId=setInterval(this.run.bind(this),1000/this.fps);this.running=true;},clear:function(color){this.context.fillStyle=color;this.context.fillRect(0,0,this.realWidth,this.realHeight);},run:function(){ig.Timer.step();this.tick=this.clock.tick();this.delegate.run();ig.input.clearPressed();if(this.newGameClass){this.setGameNow(this.newGameClass);this.newGameClass=null;}},getDrawPos:function(p){return this.smoothPositioning?(p*this.scale).round():p.round()*this.scale;}});});

// lib/impact/input.js
ig.baked=true;ig.module('impact.input').defines(function(){ig.KEY={'MOUSE1':-1,'MOUSE2':-3,'MWHEEL_UP':-4,'MWHEEL_DOWN':-5,'BACKSPACE':8,'TAB':9,'ENTER':13,'PAUSE':19,'CAPS':20,'ESC':27,'SPACE':32,'PAGE_UP':33,'PAGE_DOWN':34,'END':35,'HOME':36,'LEFT_ARROW':37,'UP_ARROW':38,'RIGHT_ARROW':39,'DOWN_ARROW':40,'INSERT':45,'DELETE':46,'0':48,'1':49,'2':50,'3':51,'4':52,'5':53,'6':54,'7':55,'8':56,'9':57,'A':65,'B':66,'C':67,'D':68,'E':69,'F':70,'G':71,'H':72,'I':73,'J':74,'K':75,'L':76,'M':77,'N':78,'O':79,'P':80,'Q':81,'R':82,'S':83,'T':84,'U':85,'V':86,'W':87,'X':88,'Y':89,'Z':90,'NUMPAD_0':96,'NUMPAD_1':97,'NUMPAD_2':98,'NUMPAD_3':99,'NUMPAD_4':100,'NUMPAD_5':101,'NUMPAD_6':102,'NUMPAD_7':103,'NUMPAD_8':104,'NUMPAD_9':105,'MULTIPLY':106,'ADD':107,'SUBSTRACT':109,'DECIMAL':110,'DIVIDE':111,'F1':112,'F2':113,'F3':114,'F4':115,'F5':116,'F6':117,'F7':118,'F8':119,'F9':120,'F10':121,'F11':122,'F12':123,'SHIFT':16,'CTRL':17,'ALT':18,'PLUS':187,'COMMA':188,'MINUS':189,'PERIOD':190};ig.Input=ig.Class.extend({bindings:{},actions:{},locks:{},delayedKeyup:[],isUsingMouse:false,isUsingKeyboard:false,mouse:{x:0,y:0},initMouse:function(){if(this.isUsingMouse){return;}
this.isUsingMouse=true;window.addEventListener('mousewheel',this.mousewheel.bind(this),false);ig.system.canvas.addEventListener('contextmenu',this.contextmenu.bind(this),false);ig.system.canvas.addEventListener('mousedown',this.keydown.bind(this),false);ig.system.canvas.addEventListener('mouseup',this.keyup.bind(this),false);ig.system.canvas.addEventListener('mousemove',this.mousemove.bind(this),false);ig.system.canvas.addEventListener('touchstart',this.keydown.bind(this),false);ig.system.canvas.addEventListener('touchend',this.keyup.bind(this),false);ig.system.canvas.addEventListener('touchmove',this.mousemove.bind(this),false);},initKeyboard:function(){if(this.isUsingKeyboard){return;}
this.isUsingKeyboard=true;window.addEventListener('keydown',this.keydown.bind(this),false);window.addEventListener('keyup',this.keyup.bind(this),false);},mousewheel:function(event){var code=event.wheel>0?ig.KEY.MWHEEL_UP:ig.KEY.MWHEEL_DOWN;var action=this.bindings[code];if(action){this.actions[action]=true;event.stopPropagation();this.delayedKeyup.push(action);}},mousemove:function(event){var el=ig.system.canvas;var pos={left:0,top:0};while(el!=null){pos.left+=el.offsetLeft;pos.top+=el.offsetTop;el=el.offsetParent;}
var tx=event.pageX;var ty=event.pageY;if(event.targetTouches){tx=event.targetTouches[0].clientX;ty=event.targetTouches[0].clientY;}
this.mouse.x=(tx-pos.left)/ig.system.scale;this.mouse.y=(ty-pos.top)/ig.system.scale;},contextmenu:function(event){if(this.bindings[ig.KEY.MOUSE2]){event.stopPropagation();event.preventDefault();}},keydown:function(event){if(event.target.type=='text'){return;}
var code=event.type=='keydown'?event.keyCode:(event.button==2?ig.KEY.MOUSE2:ig.KEY.MOUSE1);if(event.type=='touchstart'){this.mousemove(event);}
var action=this.bindings[code];if(action){this.actions[action]=true;event.stopPropagation();event.preventDefault();}},keyup:function(event){if(event.target.type=='text'){return;}
var code=event.type=='keyup'?event.keyCode:(event.button==2?ig.KEY.MOUSE2:ig.KEY.MOUSE1);var action=this.bindings[code];if(action){this.delayedKeyup.push(action);event.stopPropagation();event.preventDefault();}},bind:function(key,action){if(key<0){this.initMouse();}
else if(key>0){this.initKeyboard();}
this.bindings[key]=action;},bindTouch:function(selector,action){var element=ig.$(selector);var that=this;element.addEventListener('touchstart',function(ev){that.touchStart(ev,action);},false);element.addEventListener('touchend',function(ev){that.touchEnd(ev,action);},false);},unbind:function(key){this.bindings[key]=null;},unbindAll:function(){this.bindings=[];},state:function(action){return this.actions[action];},pressed:function(action){if(!this.locks[action]&&this.actions[action]){this.locks[action]=true;return true;}
else{return false;}},clearPressed:function(){for(var i=0;i<this.delayedKeyup.length;i++){var action=this.delayedKeyup[i];this.locks[action]=false;this.actions[action]=false;}
this.delayedKeyup=[];},touchStart:function(event,action){this.actions[action]=true;event.stopPropagation();event.preventDefault();return false;},touchEnd:function(event,action){this.delayedKeyup.push(action);event.stopPropagation();event.preventDefault();return false;}});});

// lib/impact/impact.js
ig.baked=true;ig.module('impact.impact').requires('dom.ready','impact.loader','impact.system','impact.input','impact.sound').defines(function(){ig.main=function(canvasId,gameClass,fps,width,height,scale,loaderClass){ig.system=new ig.System(canvasId,fps,width,height,scale||1);ig.input=new ig.Input();ig.soundManager=new ig.SoundManager();ig.music=new ig.Music();ig.ready=true;var loader=new(loaderClass||ig.Loader)(gameClass,ig.resources);loader.load();};});

// lib/impact/myimage.js
ig.baked=true;ig.module('impact.myimage').defines(function(){ig.MyImage=ig.Image.extend({customScale:1,getScale:function(){return this.customScale;},setScale:function(scale){this.customScale=scale;},draw:function(targetX,targetY,sourceX,sourceY,width,height){if(!this.loaded){return;}
var scale=ig.system.scale;sourceX=sourceX?sourceX*scale:0;sourceY=sourceY?sourceY*scale:0;width=(width?width:this.width)*scale;height=(height?height:this.height)*scale;ig.system.context.drawImage(this.data,sourceX,sourceY,width,height,ig.system.getDrawPos(targetX),ig.system.getDrawPos(targetY),width*this.customScale,height*this.customScale);},drawTile:function(targetX,targetY,tile,tileWidth,tileHeight,flipX,flipY){tileHeight=tileHeight?tileHeight:tileWidth;if(!this.loaded||tileWidth>this.width||tileHeight>this.height){return;}
var scale=ig.system.scale;var test=tileWidth;var tileWidthScaled=tileWidth*scale;var tileHeightScaled=tileHeight*scale;var scaleX=flipX?-1:1;var scaleY=flipY?-1:1;if(flipX||flipY){ig.system.context.save();ig.system.context.scale(scaleX,scaleY);}
ig.system.context.drawImage(this.data,((tile*tileWidth).floor()%this.width)*scale,((tile*tileWidth/this.width).floor()*tileHeight)*scale,tileWidthScaled,tileHeightScaled,ig.system.getDrawPos(targetX)*scaleX-(flipX?tileWidthScaled:0),ig.system.getDrawPos(targetY)*scaleY-(flipY?tileHeightScaled:0),tileWidthScaled*this.customScale,tileHeightScaled*this.customScale);if(flipX||flipY){ig.system.context.restore();}},});});

// lib/impact/animation.js
ig.baked=true;ig.module('impact.animation').requires('impact.timer','impact.myimage').defines(function(){ig.AnimationSheet=ig.Class.extend({width:8,height:8,scale:1,image:null,init:function(path,width,height,scale){this.width=width*scale;this.height=height*scale;this.scale=scale;this.image=new ig.MyImage(path);this.image.setScale(scale);}});ig.Animation=ig.Class.extend({sheet:null,timer:null,sequence:[],flip:{x:false,y:false},pivot:{x:0,y:0},frame:0,tile:0,loopCount:0,alpha:1,angle:0,init:function(sheet,frameTime,sequence,stop){this.sheet=sheet;this.pivot={x:sheet.width/2,y:sheet.height/2};this.timer=new ig.Timer();this.frameTime=frameTime;this.sequence=sequence;this.stop=!!stop;},rewind:function(){this.timer.reset();this.loopCount=0;this.tile=this.sequence[0];return this;},gotoFrame:function(f){this.timer.set(this.frameTime*-f);this.update();},gotoRandomFrame:function(){this.gotoFrame((Math.random()*this.sequence.length).floor())},update:function(){var frameTotal=(this.timer.delta()/this.frameTime).floor();this.loopCount=(frameTotal/this.sequence.length).floor();if(this.stop&&this.loopCount>0){this.frame=this.sequence.length-1;}
else{this.frame=frameTotal%this.sequence.length;}
this.tile=this.sequence[this.frame];},draw:function(targetX,targetY){var bbsize=Math.max(this.sheet.width,this.sheet.height);if(targetX>ig.system.width||targetY>ig.system.height||targetX+bbsize<0||targetY+bbsize<0){return;}
if(this.alpha!=1){ig.system.context.globalAlpha=this.alpha;}
if(this.angle==0){this.sheet.image.drawTile(targetX,targetY,this.tile,this.sheet.width/this.sheet.scale,this.sheet.height/this.sheet.scale,this.flip.x,this.flip.y);}
else{ig.system.context.save();ig.system.context.translate(ig.system.getDrawPos(targetX+this.pivot.x),ig.system.getDrawPos(targetY+this.pivot.y));ig.system.context.rotate(this.angle);this.sheet.image.drawTile(-this.pivot.x,-this.pivot.y,this.tile,this.sheet.width/this.sheet.scale,this.sheet.height/this.sheet.scale,this.flip.x,this.flip.y);ig.system.context.restore();}
if(this.alpha!=1){ig.system.context.globalAlpha=1;}}});});

// lib/impact/entity.js
ig.baked=true;ig.module('impact.entity').requires('impact.animation','impact.impact').defines(function(){ig.Entity=ig.Class.extend({id:0,settings:{},size:{x:16,y:16},offset:{x:0,y:0},pos:{x:0,y:0},last:{x:0,y:0},vel:{x:0,y:0},accel:{x:0,y:0},friction:{x:0,y:0},maxVel:{x:100,y:100},zIndex:0,gravityFactor:1,standing:false,bounciness:0,minBounceVelocity:40,anims:{},animSheet:null,currentAnim:null,health:10,type:0,checkAgainst:0,collides:0,init:function(x,y,settings){this.id=++ig.Entity._lastId;this.pos.x=x;this.pos.y=y;ig.merge(this,settings);},addAnim:function(name,frameTime,sequence,stop){if(!this.animSheet){throw('No animSheet to add the animation '+name+' to.');}
var a=new ig.Animation(this.animSheet,frameTime,sequence,stop);this.anims[name]=a;if(!this.currentAnim){this.currentAnim=a;}
return a;},update:function(){this.last.x=this.pos.x;this.last.y=this.pos.y;this.vel.y+=ig.game.gravity*ig.system.tick*this.gravityFactor;this.vel.x=this.getNewVelocity(this.vel.x,this.accel.x,this.friction.x,this.maxVel.x);this.vel.y=this.getNewVelocity(this.vel.y,this.accel.y,this.friction.y,this.maxVel.y);var mx=this.vel.x*ig.system.tick;var my=this.vel.y*ig.system.tick;var res=ig.game.collisionMap.trace(this.pos.x,this.pos.y,mx,my,this.size.x,this.size.y);this.handleMovementTrace(res);if(this.currentAnim){this.currentAnim.update();}},getNewVelocity:function(vel,accel,friction,max){if(accel){return(vel+accel*ig.system.tick).limit(-max,max);}
else if(friction){var delta=friction*ig.system.tick;if(vel-delta>0){return vel-delta;}
else if(vel+delta<0){return vel+delta;}
else{return 0;}}
return vel.limit(-max,max);},handleMovementTrace:function(res){this.standing=false;if(res.collision.y){if(this.bounciness>0&&Math.abs(this.vel.y)>this.minBounceVelocity){this.vel.y*=-this.bounciness;}
else{if(this.vel.y>0){this.standing=true;}
this.vel.y=0;}}
if(res.collision.x){if(this.bounciness>0&&Math.abs(this.vel.x)>this.minBounceVelocity){this.vel.x*=-this.bounciness;}
else{this.vel.x=0;}}
this.pos=res.pos;},draw:function(){if(this.currentAnim){this.currentAnim.draw(this.pos.x.round()-this.offset.x-ig.game.screen.x,this.pos.y.round()-this.offset.y-ig.game.screen.y);}},kill:function(){ig.game.removeEntity(this);},receiveDamage:function(amount,from){this.health-=amount;if(this.health<=0){this.kill();}},touches:function(other){return!(this.pos.x>other.pos.x+other.size.x||this.pos.x+this.size.x<other.pos.x||this.pos.y>other.pos.y+other.size.y||this.pos.y+this.size.y<other.pos.y);},distanceTo:function(other){var xd=(this.pos.x+this.size.x/2)-(other.pos.x+other.size.x/2);var yd=(this.pos.y+this.size.y/2)-(other.pos.y+other.size.y/2);return Math.sqrt(xd*xd+yd*yd);},angleTo:function(other){return Math.atan2((other.pos.y+other.size.y/2)-(this.pos.y+this.size.y/2),(other.pos.x+other.size.x/2)-(this.pos.x+this.size.x/2));},check:function(other){},collideWith:function(other,axis){}});ig.Entity._lastId=0;ig.Entity.COLLIDES={NEVER:0,LITE:1,PASSIVE:2,ACTIVE:4,FIXED:8};ig.Entity.TYPE={NONE:0,A:1,B:2,BOTH:3};ig.Entity.checkPair=function(a,b){if(a.checkAgainst&b.type){a.check(b);}
if(b.checkAgainst&a.type){b.check(a);}
if(a.collides&&b.collides&&a.collides+b.collides>ig.Entity.COLLIDES.ACTIVE){ig.Entity.solveCollision(a,b);}};ig.Entity.solveCollision=function(a,b){var weak=null;if(a.collides==ig.Entity.COLLIDES.LITE||b.collides==ig.Entity.COLLIDES.FIXED){weak=a;}
else if(b.collides==ig.Entity.COLLIDES.LITE||a.collides==ig.Entity.COLLIDES.FIXED){weak=b;}
if(a.last.x+a.size.x>b.last.x&&a.last.x<b.last.x+b.size.x){if(a.last.y<b.last.y){ig.Entity.seperateOnYAxis(a,b,weak);}
else{ig.Entity.seperateOnYAxis(b,a,weak);}
a.collideWith(b,'y');b.collideWith(a,'y');}
else if(a.last.y+a.size.y>b.last.y&&a.last.y<b.last.y+b.size.y){if(a.last.x<b.last.x){ig.Entity.seperateOnXAxis(a,b,weak);}
else{ig.Entity.seperateOnXAxis(b,a,weak);}
a.collideWith(b,'x');b.collideWith(a,'x');}};ig.Entity.seperateOnXAxis=function(left,right,weak){var nudge=(left.pos.x+left.size.x-right.pos.x);if(weak){var strong=left===weak?right:left;weak.vel.x=-weak.vel.x*weak.bounciness+strong.vel.x;var resWeak=ig.game.collisionMap.trace(weak.pos.x,weak.pos.y,weak==left?-nudge:nudge,0,weak.size.x,weak.size.y);weak.pos.x=resWeak.pos.x;}
else{var v2=(left.vel.x-right.vel.x)/2;left.vel.x=-v2;right.vel.x=v2;var resLeft=ig.game.collisionMap.trace(left.pos.x,left.pos.y,-nudge/2,0,left.size.x,left.size.y);left.pos.x=resLeft.pos.x.floor();var resRight=ig.game.collisionMap.trace(right.pos.x,right.pos.y,nudge/2,0,right.size.x,right.size.y);right.pos.x=resRight.pos.x.ceil();}};ig.Entity.seperateOnYAxis=function(top,bottom,weak){var nudge=(top.pos.y+top.size.y-bottom.pos.y);if(weak){var strong=top===weak?bottom:top;weak.vel.y=-weak.vel.y*weak.bounciness+strong.vel.y;var nudgeX=0;if(weak==top&&Math.abs(weak.vel.y-strong.vel.y)<weak.minBounceVelocity){weak.standing=true;nudgeX=strong.vel.x*ig.system.tick;}
var resWeak=ig.game.collisionMap.trace(weak.pos.x,weak.pos.y,nudgeX,weak==top?-nudge:nudge,weak.size.x,weak.size.y);weak.pos.y=resWeak.pos.y;weak.pos.x=resWeak.pos.x;}
else if(ig.game.gravity&&(bottom.standing||top.vel.y>0)){var resTop=ig.game.collisionMap.trace(top.pos.x,top.pos.y,0,-(top.pos.y+top.size.y-bottom.pos.y),top.size.x,top.size.y);top.pos.y=resTop.pos.y;if(top.bounciness>0&&top.vel.y>top.minBounceVelocity){top.vel.y*=-top.bounciness;}
else{top.standing=true;top.vel.y=0;}}
else{var v2=(top.vel.y-bottom.vel.y)/2;top.vel.y=-v2;bottom.vel.y=v2;var nudgeX=bottom.vel.x*ig.system.tick;var resTop=ig.game.collisionMap.trace(top.pos.x,top.pos.y,nudgeX,-nudge/2,top.size.x,top.size.y);top.pos.y=resTop.pos.y;var resBottom=ig.game.collisionMap.trace(bottom.pos.x,bottom.pos.y,0,nudge/2,bottom.size.x,bottom.size.y);bottom.pos.y=resBottom.pos.y;}};});

// lib/impact/map.js
ig.baked=true;ig.module('impact.map').defines(function(){ig.Map=ig.Class.extend({tilesize:8,width:1,height:1,data:[[]],init:function(tilesize,data){this.tilesize=tilesize;this.data=data;this.height=data.length;this.width=data[0].length;},getTile:function(x,y){var tx=(x/this.tilesize).floor();var ty=(y/this.tilesize).floor();if((tx>=0&&tx<this.width)&&(ty>=0&&ty<this.height)){return this.data[ty][tx];}
else{return 0;}},setTile:function(x,y,tile){var tx=(x/this.tilesize).floor();var ty=(y/this.tilesize).floor();if((tx>=0&&tx<this.width)&&(ty>=0&&ty<this.height)){this.data[ty][tx]=tile;}},});});

// lib/impact/collision-map.js
ig.baked=true;ig.module('impact.collision-map').requires('impact.map').defines(function(){ig.CollisionMap=ig.Map.extend({firstSolidTile:1,lastSolidTile:255,init:function(tilesize,data){this.parent(tilesize,data);},trace:function(x,y,vx,vy,objectWidth,objectHeight){var res={collision:{x:false,y:false},pos:{x:x,y:y},tile:{x:0,y:0}};var steps=(Math.max(Math.abs(vx),Math.abs(vy))/this.tilesize).ceil();if(steps>1){var sx=vx/steps;var sy=vy/steps;for(var i=0;i<steps&&(sx||sy);i++){this._traceStep(res,x,y,sx,sy,objectWidth,objectHeight);x=res.pos.x;y=res.pos.y;if(res.collision.x){sx=0;}
if(res.collision.y){sy=0;}}}
else{this._traceStep(res,x,y,vx,vy,objectWidth,objectHeight);}
return res;},_traceStep:function(res,x,y,vx,vy,width,height){res.pos.x+=vx;res.pos.y+=vy;if(vx){var pxOffsetX=(vx>0?width:0);var tileOffsetX=(vx<0?this.tilesize:0);var firstTileY=(y/this.tilesize).floor();var lastTileY=((y+height)/this.tilesize).ceil();var tileX=((x+vx+pxOffsetX)/this.tilesize).floor();if(lastTileY>=0&&firstTileY<this.height&&tileX>=0&&tileX<this.width){for(var tileY=firstTileY;tileY<lastTileY;tileY++){var t=this.data[tileY]&&this.data[tileY][tileX];if(t>=this.firstSolidTile&&t<=this.lastSolidTile){res.collision.x=true;res.tile.x=t;res.pos.x=tileX*this.tilesize-pxOffsetX+tileOffsetX;break;}}}}
if(vy){var pxOffsetY=(vy>0?height:0);var tileOffsetY=(vy<0?this.tilesize:0);var firstTileX=(res.pos.x/this.tilesize).floor();var lastTileX=((res.pos.x+width)/this.tilesize).ceil();var tileY=((y+vy+pxOffsetY)/this.tilesize).floor();if(lastTileX>=0&&firstTileX<this.width&&tileY>=0&&tileY<this.height){for(var tileX=firstTileX;tileX<lastTileX;tileX++){var t=this.data[tileY]&&this.data[tileY][tileX];if(t>=this.firstSolidTile&&t<=this.lastSolidTile){res.collision.y=true;res.tile.y=t;res.pos.y=tileY*this.tilesize-pxOffsetY+tileOffsetY;break;}}}}}});ig.CollisionMap.staticNoCollision={trace:function(x,y,vx,vy){return{collision:{x:false,y:false},pos:{x:x+vx,y:y+vy},tile:{x:0,y:0}};}};});

// lib/impact/background-map.js
ig.baked=true;ig.module('impact.background-map').requires('impact.map','impact.image').defines(function(){ig.BackgroundMap=ig.Map.extend({tiles:null,scroll:{x:0,y:0},distance:1,repeat:false,tilesetName:'',preRender:false,preRenderedChunks:null,chunkSize:512,debugChunks:false,anims:{},init:function(tilesize,data,tileset){this.parent(tilesize,data);this.setTileset(tileset);},setTileset:function(tileset){this.tilesetName=tileset instanceof ig.Image?tileset.path:tileset;this.tiles=new ig.Image(this.tilesetName);this.preRenderedChunks=null;},setScreenPos:function(x,y){this.scroll.x=x/this.distance;this.scroll.y=y/this.distance;},preRenderMapToChunks:function(){var totalWidth=this.width*this.tilesize*ig.system.scale,totalHeight=this.height*this.tilesize*ig.system.scale;var chunkCols=(totalWidth/this.chunkSize).ceil(),chunkRows=(totalHeight/this.chunkSize).ceil();this.preRenderedChunks=[];for(var y=0;y<chunkRows;y++){this.preRenderedChunks[y]=[];for(var x=0;x<chunkCols;x++){var chunkWidth=(x==chunkCols-1)?totalWidth-x*this.chunkSize:this.chunkSize;var chunkHeight=(y==chunkRows-1)?totalHeight-y*this.chunkSize:this.chunkSize;this.preRenderedChunks[y][x]=this.preRenderChunk(x,y,chunkWidth,chunkHeight);}}},preRenderChunk:function(cx,cy,w,h){var tw=w/this.tilesize/ig.system.scale+1;th=h/this.tilesize/ig.system.scale+1;var nx=(cx*this.chunkSize/ig.system.scale)%this.tilesize,ny=(cy*this.chunkSize/ig.system.scale)%this.tilesize;var tx=(cx*this.chunkSize/this.tilesize/ig.system.scale).floor(),ty=(cy*this.chunkSize/this.tilesize/ig.system.scale).floor();var chunk=ig.$new('canvas');chunk.width=w;chunk.height=h;var oldContext=ig.system.context;ig.system.context=chunk.getContext("2d");for(var x=0;x<tw;x++){for(var y=0;y<th;y++){if(x+tx<this.width&&y+ty<this.height){var tile=this.data[y+ty][x+tx];if(tile){this.tiles.drawTile(x*this.tilesize-nx,y*this.tilesize-ny,tile-1,this.tilesize);}}}}
ig.system.context=oldContext;return chunk;},draw:function(){if(!this.tiles.loaded){return;}
if(this.preRender){this.drawPreRendered();}
else{this.drawTiled();}},drawPreRendered:function(){if(!this.preRenderedChunks){this.preRenderMapToChunks();}
var dx=ig.system.getDrawPos(this.scroll.x),dy=ig.system.getDrawPos(this.scroll.y);if(this.repeat){dx%=this.width*this.tilesize*ig.system.scale;dy%=this.height*this.tilesize*ig.system.scale;}
var minChunkX=Math.max((dx/this.chunkSize).floor(),0),minChunkY=Math.max((dy/this.chunkSize).floor(),0),maxChunkX=((dx+ig.system.realWidth)/this.chunkSize).ceil(),maxChunkY=((dy+ig.system.realHeight)/this.chunkSize).ceil(),maxRealChunkX=this.preRenderedChunks[0].length,maxRealChunkY=this.preRenderedChunks.length;if(!this.repeat){maxChunkX=Math.min(maxChunkX,maxRealChunkX);maxChunkY=Math.min(maxChunkY,maxRealChunkY);}
var nudgeY=0;for(var cy=minChunkY;cy<maxChunkY;cy++){var nudgeX=0;for(var cx=minChunkX;cx<maxChunkX;cx++){var chunk=this.preRenderedChunks[cy%maxRealChunkY][cx%maxRealChunkX];var x=-dx+cx*this.chunkSize-nudgeX;var y=-dy+cy*this.chunkSize-nudgeY;ig.system.context.drawImage(chunk,x,y);if(this.debugChunks){ig.system.context.strokeStyle='#f0f';ig.system.context.strokeRect(x,y,this.chunkSize,this.chunkSize);}
if(this.repeat&&chunk.width<this.chunkSize&&x+chunk.width<ig.system.realWidth){nudgeX=this.chunkSize-chunk.width;maxChunkX++;}}
if(this.repeat&&chunk.height<this.chunkSize&&y+chunk.height<ig.system.realHeight){nudgeY=this.chunkSize-chunk.height;maxChunkY++;}}},drawTiled:function(){var tile=0,anim=null,tileOffsetX=(this.scroll.x/this.tilesize).toInt(),tileOffsetY=(this.scroll.y/this.tilesize).toInt(),pxOffsetX=this.scroll.x%this.tilesize,pxOffsetY=this.scroll.y%this.tilesize,pxMinX=-pxOffsetX-this.tilesize,pxMinY=-pxOffsetY-this.tilesize,pxMaxX=ig.system.width+this.tilesize-pxOffsetX,pxMaxY=ig.system.height+this.tilesize-pxOffsetY;for(var mapY=-1,pxY=pxMinY;pxY<pxMaxY;mapY++,pxY+=this.tilesize){var tileY=mapY+tileOffsetY;if(tileY>=this.height||tileY<0){if(!this.repeat){continue;}
tileY=tileY>0?tileY%this.height:((tileY+1)%this.height)+this.height-1;}
for(var mapX=-1,pxX=pxMinX;pxX<pxMaxX;mapX++,pxX+=this.tilesize){var tileX=mapX+tileOffsetX;if(tileX>=this.width||tileX<0){if(!this.repeat){continue;}
tileX=tileX>0?tileX%this.width:((tileX+1)%this.width)+this.width-1;}
if((tile=this.data[tileY][tileX])){if((anim=this.anims[tile-1])){anim.draw(pxX,pxY);}
else{this.tiles.drawTile(pxX,pxY,tile-1,this.tilesize);}}}}}});});

// lib/impact/game.js
ig.baked=true;ig.module('impact.game').requires('impact.impact','impact.entity','impact.collision-map','impact.background-map').defines(function(){ig.Game=ig.Class.extend({clearColor:'#000000',gravity:0,screen:{x:0,y:0},entities:[],namedEntities:{},collisionMap:ig.CollisionMap.staticNoCollision,backgroundMaps:[],backgroundAnims:{},cellSize:64,loadLevel:function(data){this.screen={x:0,y:0};this.entities=[];this.namedEntities={};for(var i=0;i<data.entities.length;i++){var ent=data.entities[i];this.spawnEntity(ent.type,ent.x,ent.y,ent.settings);}
this.sortEntities();this.collisionMap=null;this.backgroundMaps=[];for(var i=0;i<data.layer.length;i++){var ld=data.layer[i];if(ld.name=='collision'){this.collisionMap=new ig.CollisionMap(ld.tilesize,ld.data);}
else{var newMap=new ig.BackgroundMap(ld.tilesize,ld.data,ld.tilesetName);newMap.anims=this.backgroundAnims[ld.tilesetName]||{};newMap.repeat=ld.repeat;newMap.distance=ld.distance;this.backgroundMaps.push(newMap);}}},getEntityByName:function(name){return this.namedEntities[name];},getEntitiesByType:function(type){var entityClass=typeof(type)==='string'?ig.global[type]:type;var a=[];for(var i=0;i<this.entities.length;i++){if(this.entities[i]instanceof entityClass){a.push(this.entities[i]);}}
return a;},spawnEntity:function(type,x,y,settings){var entityClass=typeof(type)==='string'?ig.global[type]:type;if(!entityClass){throw("Can't spawn entity of type "+type);}
var ent=new(entityClass)(x,y,settings||{});this.entities.push(ent);if(settings&&settings.name){this.namedEntities[settings.name]=ent;}
return ent;},sortEntities:function(){this.entities.sort(function(a,b){return a.zIndex-b.zIndex;});},removeEntity:function(ent){if(ent.name){delete this.namedEntities[ent.name];}
this.entities.erase(ent);},run:function(){this.update();this.draw();},update:function(){for(var i=0;i<this.entities.length;i++){this.entities[i].update();}
this.checkEntities();for(var tileset in this.backgroundAnims){var anims=this.backgroundAnims[tileset];for(var a in anims){anims[a].update();}}
for(var i=0;i<this.backgroundMaps.length;i++){this.backgroundMaps[i].setScreenPos(this.screen.x,this.screen.y);}},drawBackground:function(){},draw:function(){ig.system.clear(this.clearColor);this.drawBackground();for(var i=0;i<this.backgroundMaps.length;i++){this.backgroundMaps[i].draw();}
for(var i=0;i<this.entities.length;i++){this.entities[i].draw();}},checkEntities:function(){var hash={};for(var e=0;e<this.entities.length;e++){var entity=this.entities[e];if(e.type==ig.Entity.TYPE.NONE&&e.checkAgainst==ig.Entity.TYPE.NONE&&e.collides==ig.Entity.COLLIDES.NEVER){continue;}
var checked={},xmin=(entity.pos.x/this.cellSize).floor(),ymin=(entity.pos.y/this.cellSize).floor(),xmax=((entity.pos.x+entity.size.x)/this.cellSize).floor()+1,ymax=((entity.pos.y+entity.size.y)/this.cellSize).floor()+1;for(var x=xmin;x<xmax;x++){for(var y=ymin;y<ymax;y++){if(!hash[x]){hash[x]={};hash[x][y]=[entity];}
else if(!hash[x][y]){hash[x][y]=[entity];}
else{var cell=hash[x][y];for(var c=0;c<cell.length;c++){if(entity.touches(cell[c])&&!checked[cell[c].id]){checked[cell[c].id]=true;ig.Entity.checkPair(entity,cell[c]);}}
cell.push(entity);}}}}}});});

// lib/game/entities/finalData.js
ig.baked=true;ig.module('game.entities.finalData').defines(function(){FinalData={kScale:0.5,FRAMETIME:30,SCREEN_WIDTH:640,SCREEN_HEIGHT:960,LOGO_STEP:000,MAINMENU_STEP:111,BUILD_MAINMENU_STEP:222,GAME_STEP:333,};if(ig.ua.iPhone4||ig.ua.iPhone){if(ig.ua.viewport.height==480||ig.ua.viewport.height==320){FinalData.TOP_Y=0;}else{FinalData.TOP_Y=-25;}
FinalData.SCREEN_WIDTH=280;FinalData.SCREEN_HEIGHT=420;FinalData.kScale=280/640;}else if(ig.ua.iPad){FinalData.kScale=1;}else if(ig.ua.android){FinalData.SCREEN_WIDTH=window.innerWidth;FinalData.SCREEN_HEIGHT=window.innerWidth*1.5;FinalData.TOP_Y=0;FinalData.FRAMETIME=60;}else{FinalData.TOP_Y=0;FinalData.kScale=1;}});

// lib/game/entities/score.js
ig.baked=true;ig.module('game.entities.score').requires('impact.entity','impact.myimage','game.entities.finalData').defines(function(){EntityScore=ig.Entity.extend({type:ig.Entity.TYPE.NONE,checkAgainst:ig.Entity.TYPE.NONE,imgBack:null,m_imgWidth:0,m_imgHeight:0,m_BtnX:0,m_BtnY:0,m_BtnWidth:0,m_BtnHeight:0,count:0,name:null,tower:"",popualtion:"",arrScore:[],init:function(x,y,settings){this.parent(x,y,settings);switch(this.name){case'score':this.imgBack=new ig.MyImage("media/score.png");this.m_imgWidth=460*FinalData.kScale;this.m_imgHeight=430*FinalData.kScale;this.m_BtnX=250*FinalData.kScale;this.m_BtnY=618*FinalData.kScale;this.m_BtnWidth=143*FinalData.kScale;this.m_BtnHeight=51*FinalData.kScale;for(i=0;i<10;i++){this.arrScore[i]=ig.game.score_TowerHeight[i];}
this.getTowerHeight();break;case'gameover':this.imgBack=new ig.MyImage("media/finish.png");this.m_imgWidth=555*FinalData.kScale;this.m_imgHeight=351*FinalData.kScale;this.m_BtnX=236*FinalData.kScale;this.m_BtnY=573*FinalData.kScale;this.m_BtnWidth=171*FinalData.kScale;this.m_BtnHeight=49*FinalData.kScale;this.tower="Tower Height : "+ig.game.eng.towerCount;var val=0;for(i=0;i<ig.game.eng.towerCount;i++){val+=ig.game.eng.arrManCount[i];}
this.popualtion="Population :     "+val;break;}
this.imgBack.setScale(FinalData.kScale);this.getWH();},getTowerHeight:function(){var temp=0;for(i=0;i<9;i++){for(j=i+1;j<10;j++){if(this.arrScore[i]<this.arrScore[j]){temp=this.arrScore[i];this.arrScore[i]=this.arrScore[j];this.arrScore[j]=temp;}}}},getWH:function(){this.pos.x=FinalData.SCREEN_WIDTH/2-this.m_imgWidth/2;this.pos.y=FinalData.SCREEN_HEIGHT/2-this.m_imgHeight/2;},update:function(){this.parent();},kill:function(){this.parent();},draw:function(){this.parent();this.imgBack.draw(this.pos.x,this.pos.y);if(this.name=="score"){this.drawCenterString(400*FinalData.kScale,380*FinalData.kScale,"Tower Height",30*FinalData.kScale);for(i=0;i<10;i++){this.drawCenterString(180*FinalData.kScale,410*FinalData.kScale+i*20*FinalData.kScale,i+1,20*FinalData.kScale);this.drawCenterString(390*FinalData.kScale,410*FinalData.kScale+i*20*FinalData.kScale,this.arrScore[i],20*FinalData.kScale);}}else if(this.name=="gameover"){this.drawCenterString(330*FinalData.kScale,426*FinalData.kScale,this.popualtion,40);this.drawCenterString(330*FinalData.kScale,476*FinalData.kScale,this.tower,40);}},drawCenterString:function(x,y,str,size){ig.system.context.font=size*FinalData.kScale+"px Arial Bold";ig.system.context.textAlign='center';ig.system.context.textBaseline='middle';ig.system.context.fillStyle='#ffffff';ig.system.context.fillText(str,x,y);},});});

// lib/game/entities/buildCity/tower1.js
ig.baked=true;ig.module('game.entities.buildCity.tower1').requires('impact.entity','impact.myimage','game.entities.finalData').defines(function(){EntityTower1=ig.Entity.extend({type:ig.Entity.TYPE.NONE,checkAgainst:ig.Entity.TYPE.NONE,count:0,tower:0,strCharacter1:["media/tower1_1.png","media/tower1_2.png"],strCharacter2:["media/tower2_1.png","media/tower2_2.png"],strCharacter3:["media/tower3_1.png","media/tower3_2.png"],strCharacter4:["media/tower4_1.png","media/tower4_2.png"],tower1Width:[48,41],tower1Height:[48,40],tower2Width:[46,41],tower2Height:[44,41],tower3Width:[46,47],tower3Height:[48,44],tower4Width:[51,49],tower4Height:[51,47],init:function(x,y,settings){this.parent(x,y,settings);switch(this.tower){case 10:if(this.count<10){this.size.x=this.tower1Width[1]*FinalData.kScale;this.size.y=this.tower1Height[1]*FinalData.kScale;this.animSheet=new ig.AnimationSheet(this.strCharacter1[1],this.size.x/FinalData.kScale,this.size.y/FinalData.kScale,FinalData.kScale);}else{this.size.x=this.tower1Width[0]*FinalData.kScale;this.size.y=this.tower1Height[0]*FinalData.kScale;this.animSheet=new ig.AnimationSheet(this.strCharacter1[0],this.size.x/FinalData.kScale,this.size.y/FinalData.kScale,FinalData.kScale);}
break;case 20:if(this.count<20){this.size.x=this.tower2Width[1]*FinalData.kScale;this.size.y=this.tower2Height[1]*FinalData.kScale;this.animSheet=new ig.AnimationSheet(this.strCharacter2[1],this.size.x/FinalData.kScale,this.size.y/FinalData.kScale,FinalData.kScale);}else{this.size.x=this.tower2Width[0]*FinalData.kScale;this.size.y=this.tower2Height[0]*FinalData.kScale;this.animSheet=new ig.AnimationSheet(this.strCharacter2[0],this.size.x/FinalData.kScale,this.size.y/FinalData.kScale,FinalData.kScale);}
break;case 30:if(this.count<30){this.size.x=this.tower3Width[1]*FinalData.kScale;this.size.y=this.tower3Height[1]*FinalData.kScale;this.animSheet=new ig.AnimationSheet(this.strCharacter3[1],this.size.x/FinalData.kScale,this.size.y/FinalData.kScale,FinalData.kScale);}else{this.size.x=this.tower3Width[0]*FinalData.kScale;this.size.y=this.tower3Height[0]*FinalData.kScale;this.animSheet=new ig.AnimationSheet(this.strCharacter3[0],this.size.x/FinalData.kScale,this.size.y/FinalData.kScale,FinalData.kScale);}
break;case 40:if(this.count<40){this.size.x=this.tower4Width[1]*FinalData.kScale;this.size.y=this.tower4Height[1]*FinalData.kScale;this.animSheet=new ig.AnimationSheet(this.strCharacter4[1],this.size.x/FinalData.kScale,this.size.y/FinalData.kScale,FinalData.kScale);}else{this.size.x=this.tower4Width[0]*FinalData.kScale;this.size.y=this.tower4Height[0]*FinalData.kScale;this.animSheet=new ig.AnimationSheet(this.strCharacter4[0],this.size.x/FinalData.kScale,this.size.y/FinalData.kScale,FinalData.kScale);}
break;}
this.addAnim('run',0.2,[0]);this.currentAnim=this.anims.run;},update:function(){this.parent();},draw:function(){this.parent();this.currentAnim.draw(this.pos.x,this.pos.y);},kill:function(){this.parent();},});});

// lib/game/entities/buildCity/blasting.js
ig.baked=true;ig.module('game.entities.buildCity.blasting').requires('impact.entity','impact.myimage','game.entities.finalData').defines(function(){EntityBlasting=ig.Entity.extend({type:ig.Entity.TYPE.NONE,checkAgainst:ig.Entity.TYPE.NONE,count:0,index:0,no:0,width:0,height:0,init:function(x,y,settings){this.parent(x,y,settings);this.size.x=64*FinalData.kScale;this.size.y=64*FinalData.kScale;if(this.index==1){this.animSheet=new ig.AnimationSheet("media/blasting1.png",this.size.x/FinalData.kScale,this.size.y/FinalData.kScale,FinalData.kScale);this.addAnim('run',0.2,[0,1,2,3,4],true);}else if(this.index==2){this.animSheet=new ig.AnimationSheet("media/blasting2.png",this.size.x/FinalData.kScale,this.size.y/FinalData.kScale,FinalData.kScale);this.addAnim('run',0.2,[0,1,2,3,4,5],true);}
this.currentAnim=this.anims.run;this.pos.x=x-(this.size.x-this.width)/2;this.pos.y=y-(this.size.y-this.height)/2;},update:function(){this.parent();if(this.index==1){if(this.count>60){ig.game.eng.gameState="main";ig.game.eng.createBand();this.kill();}
else
this.count++;}else if(this.index==2){if(this.count>72){ig.game.eng.gameState="main";ig.game.arr_Popualtion[(ig.game.eng.m_SelLinePosY-ig.game.eng.m_SelLineY)/ig.game.eng.step][(ig.game.eng.m_SelLinePosX-ig.game.eng.m_SelLineX)/ig.game.eng.step]=ig.game.currentPopualtion;ig.game.arr_Tower[(ig.game.eng.m_SelLinePosY-ig.game.eng.m_SelLineY)/ig.game.eng.step][(ig.game.eng.m_SelLinePosX-ig.game.eng.m_SelLineX)/ig.game.eng.step]=ig.game.currentTowerCount;ig.game.currentTower[(ig.game.eng.m_SelLinePosY-ig.game.eng.m_SelLineY)/ig.game.eng.step][(ig.game.eng.m_SelLinePosX-ig.game.eng.m_SelLineX)/ig.game.eng.step]=this.no;ig.game.eng.tower.kill();ig.game.eng.getScore();for(i=0;i<5;i++){ig.game.eng.card[i].kill();}
ig.game.eng.m_SelLinePosY=-100;ig.game.eng.m_SelLinePosX=-100;ig.game.currentPopualtion=0;ig.game.currentTowerHeight=0;ig.game.eng.createBand();this.kill();}
else
this.count++;}},draw:function(){this.parent();this.count++;this.currentAnim.draw(this.pos.x,this.pos.y);},kill:function(){this.parent();},});});

// lib/game/entities/buildCity/card.js
ig.baked=true;ig.module('game.entities.buildCity.card').requires('impact.entity','impact.myimage','game.entities.finalData').defines(function(){EntityCard=ig.Entity.extend({type:ig.Entity.TYPE.NONE,checkAgainst:ig.Entity.TYPE.NONE,time:0,init:function(x,y,settings){this.parent(x,y,settings);this.size.x=35*FinalData.kScale;this.size.y=60*FinalData.kScale;if((Math.random()*3).toInt()+1==1){this.time=0.01;}else if((Math.random()*3).toInt()+1==2){this.time=0.02;}else
this.time=0.03;this.animSheet=new ig.AnimationSheet("media/card.png",this.size.x/FinalData.kScale,this.size.y/FinalData.kScale,FinalData.kScale);this.addAnim('run',this.time,[0,1,2]);this.currentAnim=this.anims.run;},update:function(){this.parent();},draw:function(){this.parent();this.currentAnim.draw(this.pos.x,this.pos.y);},kill:function(){this.parent();},});});

// lib/game/entities/buildCity/band.js
ig.baked=true;ig.module('game.entities.buildCity.band').requires('impact.entity','impact.myimage','game.entities.finalData').defines(function(){EntityBand=ig.Entity.extend({type:ig.Entity.TYPE.NONE,checkAgainst:ig.Entity.TYPE.NONE,m_BandX:479,m_BandY:336,m_BandStepX:0,init:function(x,y,settings){this.parent(x,y,settings);this.m_BandX*=FinalData.kScale;this.m_BandY*=FinalData.kScale;this.m_BandStepX=this.m_BandX/15;this.size.x=70*FinalData.kScale;this.size.y=280*FinalData.kScale;this.animSheet=new ig.AnimationSheet("media/band.png",this.size.x/FinalData.kScale,this.size.y/FinalData.kScale,FinalData.kScale);this.addAnim('run',0.2,[0]);this.currentAnim=this.anims.run;this.pos.y=this.m_BandY;},update:function(){this.parent();if(this.pos.x<this.m_BandX){this.pos.x+=this.m_BandStepX;}else{ig.game.eng.drawBandState=true;this.kill();}},draw:function(){this.parent();this.currentAnim.draw(this.pos.x,this.pos.y);},kill:function(){this.parent();},});});

// lib/game/entities/buildMenu.js
ig.baked=true;ig.module('game.entities.buildMenu').requires('impact.entity','impact.myimage','game.entities.buildCity.tower1','game.entities.buildCity.blasting','game.entities.buildCity.card','game.entities.buildCity.band','game.entities.finalData').defines(function(){EntityBuildMenu=ig.Entity.extend({tower:null,blasting:null,card:[],band:null,imgBack:null,imgMainBtn:null,imgBand:null,imgSelBand:null,imgTower:[],imgTower1:[],imgTower2:[],imgBorder:[],imgBreak:null,imgCard:null,imgBMan:null,m_SelLineX:104,m_SelLineY:341,m_SelLineWidth:54,m_SelLineHeight:55,m_SelLinePosX:-100,m_SelLinePosY:-100,step:75,m_bManX:278,m_bManY:265,m_bManStep:14,m_CardX:326,m_CardY:249,m_CardStep:35,towerPosX:[107,109,108,106],towerPosY:[345,345,344,341],towerX:[492,492,493,492],towerY:[346,416,487,553],towerWidth:[47,45,46,50],towerHeight:[46,46,47,50],borderX:[489,489,489,489],borderY:[341,412,482,548],m_BandX:479,m_BandY:336,m_mainBtnX:492,m_mainBtnY:17,m_mainBtnWidth:143,m_mainBtnHeight:41,m_BreakX:492,m_BreakY:646,m_BreakWidth:52,m_BreakHeight:52,m_BackWidth:640,m_BackHeight:480,towerSelect:-1,towerHigh:0,popualtion:0,putState:[false,false,false,false],gameState:"main",firstFlag:false,drawBandState:false,cickState:false,init:function(x,y,settings){this.parent(x,y,settings);this.getScore();this.loadImage();this.dataFormat();},getScore:function(){this.towerHigh=0;this.popualtion=0;for(i=0;i<5;i++){for(j=0;j<5;j++){this.towerHigh+=ig.game.arr_Tower[i][j];this.popualtion+=ig.game.arr_Popualtion[i][j];}}},loadImage:function(){this.imgBack=new ig.MyImage("media/build_back.png");this.imgBack.setScale(FinalData.kScale);this.imgMainBtn=new ig.MyImage("media/btn_menu.png");this.imgSelBand=new ig.MyImage("media/line.png");this.imgSelBand.setScale(FinalData.kScale);this.imgMainBtn.setScale(FinalData.kScale);this.imgBreak=new ig.MyImage("media/break.png");this.imgBreak.setScale(FinalData.kScale);this.imgBand=new ig.MyImage("media/band.png");this.imgBand.setScale(FinalData.kScale);for(i=0;i<4;i++){this.imgTower[i]=new ig.MyImage("media/tower"+(i+1)+".png");this.imgTower[i].setScale(FinalData.kScale);this.imgBorder[i]=new ig.MyImage("media/border"+(i+1)+".png");this.imgBorder[i].setScale(FinalData.kScale);this.imgTower1[i]=new ig.MyImage("media/tower"+(i+1)+"_1.png");this.imgTower1[i].setScale(FinalData.kScale);this.imgTower2[i]=new ig.MyImage("media/tower"+(i+1)+"_2.png");this.imgTower2[i].setScale(FinalData.kScale);}
this.imgCard=new ig.MyImage("media/card1.png");this.imgCard.setScale(FinalData.kScale);this.imgBMan=new ig.MyImage("media/bMan.png");this.imgBMan.setScale(FinalData.kScale);},dataFormat:function(){this.m_SelLineX*=FinalData.kScale;this.m_SelLineY*=FinalData.kScale;this.m_BandX*=FinalData.kScale;this.m_BandY*=FinalData.kScale;this.m_SelLineWidth*=FinalData.kScale;this.m_SelLineHeight*=FinalData.kScale;this.m_mainBtnX*=FinalData.kScale;this.m_mainBtnY*=FinalData.kScale;this.m_mainBtnWidth*=FinalData.kScale;this.m_mainBtnHeight*=FinalData.kScale;this.m_BreakX*=FinalData.kScale;this.m_BreakY*=FinalData.kScale;this.m_BreakWidth*=FinalData.kScale;this.m_BreakHeight*=FinalData.kScale;this.m_BackWidth*=FinalData.kScale;this.m_BackHeight*=FinalData.kScale;this.m_CardX*=FinalData.kScale;this.m_CardY*=FinalData.kScale;this.m_CardStep*=FinalData.kScale;this.m_bManX*=FinalData.kScale;this.m_bManY*=FinalData.kScale;this.m_bManStep*=FinalData.kScale;this.step*=FinalData.kScale;for(i=0;i<4;i++){this.towerX[i]*=FinalData.kScale;this.towerY[i]*=FinalData.kScale;this.towerWidth[i]*=FinalData.kScale;this.towerHeight[i]*=FinalData.kScale;this.borderX[i]*=FinalData.kScale;this.borderY[i]*=FinalData.kScale;this.towerPosX[i]*=FinalData.kScale;this.towerPosY[i]*=FinalData.kScale;}},getPosTower:function(val){switch(val){case 0:for(i=0;i<5;i++){for(j=0;j<5;j++){if(this.checkPutPos(i,j,val))
ig.game.lineTower[i][j]=1;}}
break;case 1:for(i=0;i<5;i++){for(j=0;j<5;j++){if(this.checkPutPos(i,j,1)){ig.game.lineTower[i][j]=1;this.putState[1]=true;}else ig.game.lineTower[i][j]=0;}}
break;case 2:for(i=0;i<5;i++){for(j=0;j<5;j++){if(this.checkPutPos(i,j,2)){ig.game.lineTower[i][j]=1;this.putState[2]=true;}else ig.game.lineTower[i][j]=0;}}
break;case 3:for(i=0;i<5;i++){for(j=0;j<5;j++){if(this.checkPutPos(i,j,3)){ig.game.lineTower[i][j]=1;this.putState[3]=true;}else ig.game.lineTower[i][j]=0;}}
break;}},checkPutPos:function(i,j,val){var bool=false;switch(val){case 0:bool=true;break
case 1:if(j>0&&ig.game.currentTower[i][j-1]==1){bool=true;}else if(i>0&&ig.game.currentTower[i-1][j]==1){bool=true;}else if(j<4&&ig.game.currentTower[i][j+1]==1){bool=true;}else if(i<4&&ig.game.currentTower[i+1][j]==1){bool=true;}
break;case 2:if(j>0&&i>0&&ig.game.currentTower[i][j-1]!=0&&ig.game.currentTower[i-1][j]!=0&&ig.game.currentTower[i][j-1]!=ig.game.currentTower[i-1][j]&&ig.game.currentTower[i][j-1]+ig.game.currentTower[i-1][j]==3){bool=true;}else if(j<4&&i>0&&ig.game.currentTower[i-1][j]!=0&&ig.game.currentTower[i][j+1]!=0&&ig.game.currentTower[i-1][j]!=ig.game.currentTower[i][j+1]&&ig.game.currentTower[i-1][j]+ig.game.currentTower[i][j+1]==3){bool=true;}else if(j<4&&i<4&&ig.game.currentTower[i][j+1]!=0&&ig.game.currentTower[i+1][j]!=0&&ig.game.currentTower[i][j+1]!=ig.game.currentTower[i+1][j]&&ig.game.currentTower[i][j+1]+ig.game.currentTower[i+1][j]==3){bool=true;}else if(j>0&&i<4&&ig.game.currentTower[i+1][j]!=0&&ig.game.currentTower[i][j-1]!=0&&ig.game.currentTower[i+1][j]!=ig.game.currentTower[i][j-1]&&ig.game.currentTower[i+1][j]+ig.game.currentTower[i][j-1]==3){bool=true;}else if(i>0&&i<4&&ig.game.currentTower[i-1][j]!=0&&ig.game.currentTower[i+1][j]!=0&&ig.game.currentTower[i-1][j]!=ig.game.currentTower[i+1][j]&&ig.game.currentTower[i-1][j]+ig.game.currentTower[i+1][j]==3){bool=true;}else if(j>0&&j<4&&ig.game.currentTower[i][j-1]!=0&&ig.game.currentTower[i][j+1]!=0&&ig.game.currentTower[i][j-1]!=ig.game.currentTower[i][j+1]&&ig.game.currentTower[i][j-1]+ig.game.currentTower[i][j+1]==3){bool=true;}
break;case 3:if(j>0&&i>0&&j<4&&ig.game.currentTower[i][j-1]!=0&&ig.game.currentTower[i-1][j]!=0&&ig.game.currentTower[i][j+1]!=0&&ig.game.currentTower[i][j-1]!=ig.game.currentTower[i-1][j]&&ig.game.currentTower[i][j-1]!=ig.game.currentTower[i][j+1]&&ig.game.currentTower[i-1][j]!=ig.game.currentTower[i][j+1]&&ig.game.currentTower[i][j-1]+ig.game.currentTower[i-1][j]+ig.game.currentTower[i][j+1]==6){bool=true;}else if(i>0&&i<4&&j<4&&ig.game.currentTower[i-1][j]!=0&&ig.game.currentTower[i][j+1]!=0&&ig.game.currentTower[i+1][j]!=0&&ig.game.currentTower[i-1][j]!=ig.game.currentTower[i][j+1]&&ig.game.currentTower[i-1][j]!=ig.game.currentTower[i+1][j]&&ig.game.currentTower[i][j+1]!=ig.game.currentTower[i+1][j]&&ig.game.currentTower[i-1][j]+ig.game.currentTower[i][j+1]+ig.game.currentTower[i+1][j]==6){bool=true;}else if(j>0&&i<4&&j<4&&ig.game.currentTower[i][j+1]!=0&&ig.game.currentTower[i+1][j]!=0&&ig.game.currentTower[i][j-1]!=0&&ig.game.currentTower[i][j+1]!=ig.game.currentTower[i+1][j]&&ig.game.currentTower[i][j+1]!=ig.game.currentTower[i][j-1]&&ig.game.currentTower[i+1][j]!=ig.game.currentTower[i][j-1]&&ig.game.currentTower[i][j+1]+ig.game.currentTower[i+1][j]+ig.game.currentTower[i][j-1]==6){bool=true;}else if(j>0&&i<4&&i>0&&ig.game.currentTower[i+1][j]!=0&&ig.game.currentTower[i][j-1]!=0&&ig.game.currentTower[i-1][j]!=0&&ig.game.currentTower[i+1][j]!=ig.game.currentTower[i][j-1]&&ig.game.currentTower[i+1][j]!=ig.game.currentTower[i-1][j]&&ig.game.currentTower[i][j-1]!=ig.game.currentTower[i-1][j]&&ig.game.currentTower[i+1][j]+ig.game.currentTower[i][j-1]+ig.game.currentTower[i-1][j]==6){bool=true;}
break;}
return bool;},checkTowerPos:function(x,y){var bool=false;for(i=0;i<5;i++){for(j=0;j<5;j++){if(this.checkPutPos(i,j,ig.game.buildTower/10-1)&&x>=this.m_SelLineX+j*this.step&&x<=this.m_SelLineX+j*this.step+this.m_SelLineWidth&&y>=this.m_SelLineY+i*this.step&&y<=this.m_SelLineY+i*this.step+this.m_SelLineHeight){this.m_SelLinePosX=this.m_SelLineX+j*this.step;this.m_SelLinePosY=this.m_SelLineY+i*this.step;bool=true;break;}else{this.m_SelLinePosX=-100;this.m_SelLinePosY=-100;}}
if(bool)
break;}},keyCheckBuild:function(){var x,y;x=ig.input.mouse.x;y=ig.input.mouse.y;if(this.drawBandState){if(ig.game.towerCount>=1&&x>=this.towerX[0]&&x<=this.towerX[0]+this.towerWidth[0]&&y>=this.towerY[0]&&y<=this.towerY[0]+this.towerHeight[0]){this.towerSelect=0;}else if(ig.game.towerCount>=2&&x>=this.towerX[1]&&x<=this.towerX[1]+this.towerWidth[1]&&y>=this.towerY[1]&&y<=this.towerY[1]+this.towerHeight[1]){this.towerSelect=1;}else if(ig.game.towerCount>=3&&x>=this.towerX[2]&&x<=this.towerX[2]+this.towerWidth[2]&&y>=this.towerY[2]&&y<=this.towerY[2]+this.towerHeight[2]){this.towerSelect=2;}else if(ig.game.towerCount>=4&&x>=this.towerX[3]&&x<=this.towerX[3]+this.towerWidth[3]&&y>=this.towerY[3]&&y<=this.towerY[3]+this.towerHeight[3]){this.towerSelect=3;}else{this.towerSelect=-1;}
this.getPosTower(this.towerSelect);}
if(ig.input.pressed('mouse')){if(x>=this.m_mainBtnX&&x<=this.m_mainBtnX+this.m_mainBtnWidth&&y>=this.m_mainBtnY&&y<=this.m_mainBtnY+this.m_mainBtnHeight){ig.game.quickState=false;ig.game.currentTowerCount=0;ig.game.gotoStep(FinalData.MAINMENU_STEP);}else if(ig.game.towerCount>=1&&x>=this.towerX[0]&&x<=this.towerX[0]+this.towerWidth[0]&&y>=this.towerY[0]&&y<=this.towerY[0]+this.towerHeight[0]){this.kill();ig.game.buildTower=10;ig.game.gotoStep(FinalData.GAME_STEP);}else if(ig.game.towerCount>=2&&x>=this.towerX[1]&&x<=this.towerX[1]+this.towerWidth[1]&&y>=this.towerY[1]&&y<=this.towerY[1]+this.towerHeight[1]){this.kill();ig.game.buildTower=20;ig.game.gotoStep(FinalData.GAME_STEP);}else if(ig.game.towerCount>=3&&x>=this.towerX[2]&&x<=this.towerX[2]+this.towerWidth[2]&&y>=this.towerY[2]&&y<=this.towerY[2]+this.towerHeight[2]){this.kill();ig.game.buildTower=30;ig.game.gotoStep(FinalData.GAME_STEP);}else if(ig.game.towerCount>=4&&x>=this.towerX[3]&&x<=this.towerX[3]+this.towerWidth[3]&&y>=this.towerY[3]&&y<=this.towerY[3]+this.towerHeight[3]){this.kill();ig.game.buildTower=40;ig.game.gotoStep(FinalData.GAME_STEP);}}},keycheckTower:function(){var x,y;x=ig.input.mouse.x;y=ig.input.mouse.y;if(!this.clickState){this.tower.pos.x=x-this.tower.size.x/2;this.tower.pos.y=y-this.tower.size.y/2;this.checkTowerPos(x,y);}
if(ig.input.pressed('mouse')){if(x>=this.m_BreakX&&x<=this.m_BreakX+this.m_BreakWidth&&y>=this.m_BreakY&&y<=this.m_BreakY+this.m_BreakHeight){this.clickState=true;this.tower.kill();this.blasting=ig.game.spawnEntity(EntityBlasting,this.m_BreakX,this.m_BreakY,{index:1,width:this.m_BreakWidth,height:this.m_BreakHeight});}else if(this.m_SelLinePosX!=-100&&this.m_SelLinePosY!=-100&&!this.clickState){if(ig.game.buildTower==10){this.clickState=true;this.blasting=ig.game.spawnEntity(EntityBlasting,this.m_SelLinePosX,this.m_SelLinePosY,{index:2,no:1,width:this.m_SelLineWidth,height:this.m_SelLineHeight});for(i=0;i<5;i++)
this.card[i]=ig.game.spawnEntity(EntityCard,this.m_CardX+i*this.m_CardStep,this.m_CardY);}else if(ig.game.buildTower==20){if(this.checkPutPos((ig.game.eng.m_SelLinePosY-ig.game.eng.m_SelLineY)/ig.game.eng.step,(ig.game.eng.m_SelLinePosX-ig.game.eng.m_SelLineX)/ig.game.eng.step,1)){this.clickState=true;this.blasting=ig.game.spawnEntity(EntityBlasting,this.m_SelLinePosX,this.m_SelLinePosY,{index:2,no:2,width:this.m_SelLineWidth,height:this.m_SelLineHeight});for(i=0;i<5;i++)
this.card[i]=ig.game.spawnEntity(EntityCard,this.m_CardX+i*this.m_CardStep,this.m_CardY);}}else if(ig.game.buildTower==30){if(this.checkPutPos((ig.game.eng.m_SelLinePosY-ig.game.eng.m_SelLineY)/ig.game.eng.step,(ig.game.eng.m_SelLinePosX-ig.game.eng.m_SelLineX)/ig.game.eng.step,2)){this.clickState=true;this.blasting=ig.game.spawnEntity(EntityBlasting,this.m_SelLinePosX,this.m_SelLinePosY,{index:2,no:3,width:this.m_SelLineWidth,height:this.m_SelLineHeight});for(i=0;i<5;i++)
this.card[i]=ig.game.spawnEntity(EntityCard,this.m_CardX+i*this.m_CardStep,this.m_CardY);}}else if(ig.game.buildTower==40){if(this.checkPutPos((ig.game.eng.m_SelLinePosY-ig.game.eng.m_SelLineY)/ig.game.eng.step,(ig.game.eng.m_SelLinePosX-ig.game.eng.m_SelLineX)/ig.game.eng.step,3)){this.clickState=true;this.blasting=ig.game.spawnEntity(EntityBlasting,this.m_SelLinePosX,this.m_SelLinePosY,{index:2,no:4,width:this.m_SelLineWidth,height:this.m_SelLineHeight});for(i=0;i<5;i++)
this.card[i]=ig.game.spawnEntity(EntityCard,this.m_CardX+i*this.m_CardStep,this.m_CardY);}}}}},keyCheck:function(){switch(this.gameState){case"main":this.keyCheckBuild();break;case"tower":this.keycheckTower();break;}},orderByEntity:function(){if(this.blasting!=null)
this.blasting.zIndex=this.zIndex+3;if(this.tower!=null)
this.tower.zIndex=this.zIndex+4;if(this.card!=null)
this.card.zIndex=this.zIndex+4;if(this.band!=null)
this.band.zIndex=this.zIndex+4;ig.game.sortEntities();},createBand:function(){this.band=ig.game.spawnEntity(EntityBand,0,0);this.getPosTower(0);if(this.putState[0])
ig.game.towerCount=1;this.getPosTower(1);if(this.putState[1])
ig.game.towerCount=2;this.getPosTower(2);if(this.putState[2])
ig.game.towerCount=3;this.getPosTower(3);if(this.putState[3])
ig.game.towerCount=4;},update:function(){this.parent();if(!this.firstFlag){this.firstFlag=true;if(ig.game.currentTowerCount>0){this.tower=ig.game.spawnEntity(EntityTower1,0,0,{count:ig.game.currentTowerCount,tower:ig.game.buildTower});this.gameState="tower";}else{this.createBand();}}
this.keyCheck();this.orderByEntity();},draw:function(){this.parent();this.imgBack.draw(this.pos.x,this.pos.y);this.imgMainBtn.draw(this.m_mainBtnX,this.m_mainBtnY);this.imgBreak.draw(this.m_BreakX,this.m_BreakY);this.imgSelBand.draw(this.m_SelLinePosX,this.m_SelLinePosY);this.drawCenterString(133*FinalData.kScale,307*FinalData.kScale,this.towerHigh,25*FinalData.kScale);for(i=0;i<2;i++)this.imgBMan.draw(this.m_bManX+i*this.m_bManStep,this.m_bManY);var pCount=0;var unit=10000;for(i=0;i<5;i++){this.imgCard.draw(this.m_CardX+i*this.m_CardStep,this.m_CardY);if(pCount==0){pCount=1;this.drawCenterString(343*FinalData.kScale+i*this.m_CardStep,280*FinalData.kScale,(this.popualtion/unit).toInt(),40*FinalData.kScale);}else{this.drawCenterString(343*FinalData.kScale+i*this.m_CardStep,280*FinalData.kScale,((this.popualtion%unit)/(unit/10)).toInt(),40*FinalData.kScale);unit/=10;}}
if(this.drawBandState)
this.imgBand.draw(this.m_BandX,this.m_BandY);if(this.towerSelect!=-1){this.imgBorder[this.towerSelect].draw(this.borderX[this.towerSelect],this.borderY[this.towerSelect]);for(i=0;i<5;i++){for(j=0;j<5;j++){if(ig.game.lineTower[i][j]==1){this.imgSelBand.draw(this.m_SelLineX+j*this.step,this.m_SelLineY+i*this.step);}}}}
this.drawTower();if(this.drawBandState){for(i=0;i<ig.game.towerCount;i++){this.imgTower[i].draw(this.towerX[i],this.towerY[i]);}}},drawTower:function(){for(i=0;i<5;i++){for(j=0;j<5;j++){if(ig.game.currentTower[i][j]==1){if(ig.game.arr_Tower[i][j]<10){this.imgTower2[0].draw(this.towerPosX[0]+j*this.step,this.towerPosY[0]+i*this.step);}else{this.imgTower1[0].draw(this.towerPosX[0]+j*this.step,this.towerPosY[0]+i*this.step);}}else if(ig.game.currentTower[i][j]==2){if(ig.game.arr_Tower[i][j]<20){this.imgTower2[1].draw(this.towerPosX[1]+j*this.step,this.towerPosY[1]+i*this.step);}else{this.imgTower1[1].draw(this.towerPosX[1]+j*this.step,this.towerPosY[1]+i*this.step);}}else if(ig.game.currentTower[i][j]==3){if(ig.game.arr_Tower[i][j]<30){this.imgTower2[2].draw(this.towerPosX[2]+j*this.step,this.towerPosY[2]+i*this.step);}else{this.imgTower1[2].draw(this.towerPosX[2]+j*this.step,this.towerPosY[2]+i*this.step);}}else if(ig.game.currentTower[i][j]==4){if(ig.game.arr_Tower[i][j]<40){this.imgTower2[3].draw(this.towerPosX[3]+j*this.step,this.towerPosY[3]+i*this.step);}else{this.imgTower1[3].draw(this.towerPosX[3]+j*this.step,this.towerPosY[3]+i*this.step);}}}}},drawCenterString:function(x,y,str,size){ig.system.context.font=size*FinalData.kScale+"px Arial Bold";ig.system.context.textAlign='center';ig.system.context.textBaseline='middle';ig.system.context.fillStyle='#ffffff';ig.system.context.fillText(str,x,y);},kill:function(){this.parent();},});});

// lib/game/entities/mainmenu.js
ig.baked=true;ig.module('game.entities.mainmenu').requires('impact.entity','impact.myimage','game.entities.score','game.entities.buildMenu','game.entities.finalData').defines(function(){EntityMainMenu=ig.Entity.extend({imgBack:null,startBtn:null,scoreBtn:null,buildBtn:null,score:null,btnState:"menu",m_StartBtnX:128,m_StartBtnY:368,m_StartBtnWidth:384,m_StartBtnHeight:123,m_ScoreBtnX:185,m_ScoreBtnY:686,m_ScoreBtnWidth:270,m_ScoreBtnHeight:111,m_BuildBtnX:144,m_BuildBtnY:530,m_BuildBtnWidth:352,m_BuildBtnHeight:123,init:function(x,y,settings){this.parent(x,y,settings);this.imgBack=new ig.MyImage("media/menu.png");this.imgBack.setScale(FinalData.kScale);this.startBtn=new ig.MyImage("media/btn_3.png");this.startBtn.setScale(FinalData.kScale);this.scoreBtn=new ig.MyImage("media/btn_2.png");this.scoreBtn.setScale(FinalData.kScale);this.buildBtn=new ig.MyImage("media/btn_4.png");this.buildBtn.setScale(FinalData.kScale);this.getValue();},getValue:function(){this.m_StartBtnX*=FinalData.kScale;this.m_StartBtnY*=FinalData.kScale;this.m_StartBtnWidth*=FinalData.kScale;this.m_StartBtnHeight*=FinalData.kScale;this.m_ScoreBtnX*=FinalData.kScale;this.m_ScoreBtnY*=FinalData.kScale;this.m_ScoreBtnWidth*=FinalData.kScale;this.m_ScoreBtnHeight*=FinalData.kScale;this.m_BuildBtnX*=FinalData.kScale;this.m_BuildBtnY*=FinalData.kScale;this.m_BuildBtnWidth*=FinalData.kScale;this.m_BuildBtnHeight*=FinalData.kScale;},keyCheck:function(){switch(this.btnState){case"menu":this.keyCheckMenu();break;case"score":this.keyCheckScore();break;}},keyCheckMenu:function(){if(ig.input.pressed('mouse')){var x=ig.input.mouse.x;var y=ig.input.mouse.y;if(x>=this.m_StartBtnX&&x<=this.m_StartBtnX+this.m_StartBtnWidth&&y>=this.m_StartBtnY&&y<=this.m_StartBtnY+this.m_StartBtnHeight){ig.game.buildTower=0;ig.game.quickState=true;ig.game.gotoStep(FinalData.GAME_STEP);}else if(x>=this.m_ScoreBtnX&&x<=this.m_ScoreBtnX+this.m_ScoreBtnWidth&&y>=this.m_ScoreBtnY&&y<=this.m_ScoreBtnY+this.m_ScoreBtnHeight){this.btnState="score";this.score=ig.game.spawnEntity(EntityScore,0,0,{name:"score"});}else if(x>=this.m_BuildBtnX&&x<=this.m_BuildBtnX+this.m_BuildBtnWidth&&y>=this.m_BuildBtnY&&y<=this.m_BuildBtnY+this.m_BuildBtnHeight){ig.game.quickState=false;ig.game.gotoStep(FinalData.BUILD_MAINMENU_STEP);}}},keyCheckScore:function(){if(ig.input.pressed('mouse')){var x=ig.input.mouse.x;var y=ig.input.mouse.y;if(x>=this.score.m_BtnX&&x<=this.score.m_BtnX+this.score.m_BtnWidth&&y>=this.score.m_BtnY&&y<=this.score.m_BtnY+this.score.m_BtnHeight){this.score.kill();this.btnState="menu";}}},update:function(){this.parent();this.keyCheck();},draw:function(){this.parent();this.imgBack.draw(0,0);this.startBtn.draw(this.m_StartBtnX,this.m_StartBtnY);this.scoreBtn.draw(this.m_ScoreBtnX,this.m_ScoreBtnY);this.buildBtn.draw(this.m_BuildBtnX,this.m_BuildBtnY);},kill:function(){this.parent();},});});

// lib/game/entities/logic/button.js
ig.baked=true;ig.module('game.entities.logic.button').requires('impact.entity','impact.myimage','game.entities.finalData').defines(function(){EntityButton=ig.Entity.extend({type:ig.Entity.TYPE.NONE,checkAgainst:ig.Entity.TYPE.NONE,imgBack:null,name:null,m_posX:0,m_posY:0,m_posWidth:0,m_posHeight:0,init:function(x,y,settings){this.parent(x,y,settings);switch(this.name){case'menu':this.m_posX=464*FinalData.kScale;this.m_posY=73*FinalData.kScale;this.m_posWidth=171*FinalData.kScale;this.m_posHeight=49*FinalData.kScale;this.imgBack=new ig.MyImage("media/btn_menu.png");break;case'score':this.m_posX=464*FinalData.kScale;this.m_posY=128*FinalData.kScale;this.m_posWidth=171*FinalData.kScale;this.m_posHeight=49*FinalData.kScale;this.imgBack=new ig.MyImage("media/btn_score.png");break;}
this.imgBack.setScale(FinalData.kScale);},update:function(){this.parent();},kill:function(){this.parent();},draw:function(){this.parent();this.imgBack.draw(this.m_posX,this.m_posY);},});});

// lib/game/entities/logic/line.js
ig.baked=true;ig.module('game.entities.logic.line').requires('impact.entity','impact.myimage','game.entities.finalData').defines(function(){EntityLine=ig.Entity.extend({type:ig.Entity.TYPE.NONE,checkAgainst:ig.Entity.TYPE.NONE,start_x:0,start_y:0,m_LineX:0,m_LineY:0,m_LineWidth:0,m_LineHeight:0,v:7,l:10,time:0,a:0,T:0,g:30,count:0,h:0,step:0,init:function(x,y,settings){this.parent(x,y,settings);this.getPos();this.size.x=this.m_LineWidth;this.size.y=this.m_LineHeight;this.start_x=this.m_LineX;this.start_y=this.m_LineY;this.T=2*Math.PI*Math.sqrt(this.l/this.g);this.getAnim();},getPos:function(){this.m_LineX=302*FinalData.kScale;this.m_LineY=-120*FinalData.kScale;this.m_LineWidth=18*FinalData.kScale;this.m_LineHeight=300*FinalData.kScale;},getAnim:function(){this.animSheet=new ig.AnimationSheet("media/pi.png",this.size.x/FinalData.kScale,this.size.y/FinalData.kScale,FinalData.kScale);this.addAnim('line',0.2,[0]);this.currentAnim=this.anims.line;},move:function(){this.pos.x=this.start_x-(this.size.y/2)*Math.sin(this.a);this.pos.y=this.start_y-(this.size.y/2-(this.size.y/2)*Math.cos(this.a));},update:function(){this.a=this.v*Math.sin(Math.sqrt(this.g/this.l)*this.time)/Math.sqrt(this.g*this.l);this.currentAnim.angle=this.a;if(this.time<this.T/2){this.start_y-=1.5*FinalData.kScale*Math.abs(Math.cos(this.a));}else if(this.time>=this.T/2&&this.time<this.T){this.start_y+=1.5*FinalData.kScale*Math.abs(Math.cos(this.a));}else if(this.time>=this.T){this.time=0;this.start_y=this.m_LineY;}
this.time+=1/30;this.move();this.parent();},kill:function(){this.parent();},draw:function(){this.currentAnim.draw(this.pos.x,this.pos.y);this.parent();},});});

// lib/game/entities/logic/character.js
ig.baked=true;ig.module('game.entities.logic.character').requires('impact.entity','impact.image','game.entities.finalData').defines(function(){EntityCharacter=ig.Entity.extend({collides:ig.Entity.COLLIDES.PASSIVE,type:ig.Entity.TYPE.A,checkAgainst:ig.Entity.TYPE.B,strCharacter:["media/charac_2.png","media/charac_3.png","media/charac_4.png","media/charac_5.png"],strRoof:["media/roof_1.png","media/roof_2.png","media/roof_3.png","media/roof_4.png"],radian:0,count:0,state:false,set:false,anim:null,index:0,m_CharacterWidth:0,m_CharacterHeight:0,init:function(x,y,settings){this.parent(x,y,settings);switch(this.index){case 1:this.m_CharacterWidth=119*FinalData.kScale;this.m_CharacterHeight=115*FinalData.kScale;animSheet=new ig.AnimationSheet("media/charac_1.png",this.m_CharacterWidth/FinalData.kScale,this.m_CharacterHeight/FinalData.kScale,FinalData.kScale);break;case 2:this.m_CharacterWidth=100*FinalData.kScale;this.m_CharacterHeight=81*FinalData.kScale;if(ig.game.buildTower==10){animSheet=new ig.AnimationSheet(this.strCharacter[0],this.m_CharacterWidth/FinalData.kScale,this.m_CharacterHeight/FinalData.kScale,FinalData.kScale);}else if(ig.game.buildTower==20){animSheet=new ig.AnimationSheet(this.strCharacter[1],this.m_CharacterWidth/FinalData.kScale,this.m_CharacterHeight/FinalData.kScale,FinalData.kScale);}else if(ig.game.buildTower==30){animSheet=new ig.AnimationSheet(this.strCharacter[2],this.m_CharacterWidth/FinalData.kScale,this.m_CharacterHeight/FinalData.kScale,FinalData.kScale);}else if(ig.game.buildTower==40){animSheet=new ig.AnimationSheet(this.strCharacter[3],this.m_CharacterWidth/FinalData.kScale,this.m_CharacterHeight/FinalData.kScale,FinalData.kScale);}else{animSheet=new ig.AnimationSheet(this.strCharacter[0],this.m_CharacterWidth/FinalData.kScale,this.m_CharacterHeight/FinalData.kScale,FinalData.kScale);}
break;case 3:if(ig.game.buildTower==10){this.m_CharacterWidth=101*FinalData.kScale;this.m_CharacterHeight=77*FinalData.kScale;animSheet=new ig.AnimationSheet(this.strRoof[0],this.m_CharacterWidth/FinalData.kScale,this.m_CharacterHeight/FinalData.kScale,FinalData.kScale);}else if(ig.game.buildTower==20){this.m_CharacterWidth=116*FinalData.kScale;this.m_CharacterHeight=69*FinalData.kScale;animSheet=new ig.AnimationSheet(this.strRoof[1],this.m_CharacterWidth/FinalData.kScale,this.m_CharacterHeight/FinalData.kScale,FinalData.kScale);}else if(ig.game.buildTower==30){this.m_CharacterWidth=105*FinalData.kScale;this.m_CharacterHeight=80*FinalData.kScale;animSheet=new ig.AnimationSheet(this.strRoof[2],this.m_CharacterWidth/FinalData.kScale,this.m_CharacterHeight/FinalData.kScale,FinalData.kScale);}else if(ig.game.buildTower==40){this.m_CharacterWidth=69*FinalData.kScale;this.m_CharacterHeight=90*FinalData.kScale;animSheet=new ig.AnimationSheet(this.strRoof[3],this.m_CharacterWidth/FinalData.kScale,this.m_CharacterHeight/FinalData.kScale,FinalData.kScale);}
break;}
this.anim=new ig.Animation(animSheet,0.2,[0]);this.size.x=this.m_CharacterWidth;this.size.y=this.m_CharacterHeight;this.move();this.maxVel.y=2000*FinalData.kScale;},move:function(){this.pos.x=ig.game.eng.line.start_x-(ig.game.eng.line.size.y+this.size.y/2)*Math.sin(ig.game.eng.line.a)-(this.size.x/2-ig.game.eng.line.size.x/2);this.pos.y=ig.game.eng.line.start_y+(ig.game.eng.line.size.y+this.size.y/2)*Math.cos(ig.game.eng.line.a)-this.size.y/2;},update:function(){this.parent();if(!this.state){this.move();this.anim.angle=ig.game.eng.line.a;}else{if(!this.set){this.accel.y=1000*FinalData.kScale;this.vel.y=500*FinalData.kScale;this.anim.angle=0;this.set=true;}}},kill:function(){this.parent();},draw:function(){this.anim.draw(this.pos.x,this.pos.y);this.parent();},});});

// lib/game/entities/logic/tower.js
ig.baked=true;ig.module('game.entities.logic.tower').requires('impact.entity','impact.myimage','game.entities.finalData').defines(function(){EntityTower=ig.Entity.extend({type:ig.Entity.TYPE.NONE,checkAgainst:ig.Entity.TYPE.NONE,strCharacter:["media/charac_2.png","media/charac_3.png","media/charac_4.png","media/charac_5.png"],strRoof:["media/roof_1.png","media/roof_2.png","media/roof_3.png","media/roof_4.png"],index:0,count:0,start_x:0,h:0,radian:0,anim:null,m_CharacterWidth:0,m_CharacterHeight:0,init:function(x,y,settings){this.parent(x,y,settings);switch(this.index){case 1:this.m_CharacterWidth=119*FinalData.kScale;this.m_CharacterHeight=115*FinalData.kScale;animSheet=new ig.AnimationSheet("media/charac_1.png",this.m_CharacterWidth/FinalData.kScale,this.m_CharacterHeight/FinalData.kScale,FinalData.kScale);break;case 2:this.m_CharacterWidth=100*FinalData.kScale;this.m_CharacterHeight=81*FinalData.kScale;if(ig.game.buildTower==10){animSheet=new ig.AnimationSheet(this.strCharacter[0],this.m_CharacterWidth/FinalData.kScale,this.m_CharacterHeight/FinalData.kScale,FinalData.kScale);}else if(ig.game.buildTower==20){animSheet=new ig.AnimationSheet(this.strCharacter[1],this.m_CharacterWidth/FinalData.kScale,this.m_CharacterHeight/FinalData.kScale,FinalData.kScale);}else if(ig.game.buildTower==30){animSheet=new ig.AnimationSheet(this.strCharacter[2],this.m_CharacterWidth/FinalData.kScale,this.m_CharacterHeight/FinalData.kScale,FinalData.kScale);}else if(ig.game.buildTower==40){animSheet=new ig.AnimationSheet(this.strCharacter[3],this.m_CharacterWidth/FinalData.kScale,this.m_CharacterHeight/FinalData.kScale,FinalData.kScale);}else{animSheet=new ig.AnimationSheet(this.strCharacter[0],this.m_CharacterWidth/FinalData.kScale,this.m_CharacterHeight/FinalData.kScale,FinalData.kScale);}
break;case 3:if(ig.game.buildTower==10){this.m_CharacterWidth=101*FinalData.kScale;this.m_CharacterHeight=77*FinalData.kScale;animSheet=new ig.AnimationSheet(this.strRoof[0],this.m_CharacterWidth/FinalData.kScale,this.m_CharacterHeight/FinalData.kScale,FinalData.kScale);}else if(ig.game.buildTower==20){this.m_CharacterWidth=116*FinalData.kScale;this.m_CharacterHeight=69*FinalData.kScale;animSheet=new ig.AnimationSheet(this.strRoof[1],this.m_CharacterWidth/FinalData.kScale,this.m_CharacterHeight/FinalData.kScale,FinalData.kScale);}else if(ig.game.buildTower==30){this.m_CharacterWidth=105*FinalData.kScale;this.m_CharacterHeight=80*FinalData.kScale;animSheet=new ig.AnimationSheet(this.strRoof[2],this.m_CharacterWidth/FinalData.kScale,this.m_CharacterHeight/FinalData.kScale,FinalData.kScale);}else if(ig.game.buildTower==40){this.m_CharacterWidth=69*FinalData.kScale;this.m_CharacterHeight=90*FinalData.kScale;animSheet=new ig.AnimationSheet(this.strRoof[3],this.m_CharacterWidth/FinalData.kScale,this.m_CharacterHeight/FinalData.kScale,FinalData.kScale);}
break;}
this.size.x=this.m_CharacterWidth;this.size.y=this.m_CharacterHeight;this.start_x=x-this.getStepX();this.anim=new ig.Animation(animSheet,0.2,[0]);},getStepX:function(){if(this.count==0){this.h=this.size.y;}else{this.h=this.count*this.size.y+115*FinalData.kScale;;}
return this.h*Math.sin(ig.game.eng.alpha);},update:function(){this.parent();this.anim.angle=ig.game.eng.alpha;this.pos.x=this.start_x+this.getStepX();},kill:function(){this.parent();},draw:function(){this.parent();this.anim.draw(this.pos.x,this.pos.y);},});});

// lib/game/entities/logic/side.js
ig.baked=true;ig.module('game.entities.logic.side').requires('impact.entity','game.entities.finalData').defines(function(){EntitySide=ig.Entity.extend({collides:ig.Entity.COLLIDES.FIXED,type:ig.Entity.TYPE.B,checkAgainst:ig.Entity.TYPE.A,index:0,width:0,height:0,coll_state:false,init:function(x,y,settings){this.parent(x,y,settings);this.size.x=this.width;this.size.y=this.height;},check:function(A){this.coll_state=true;},kill:function(){this.parent();},update:function(){this.parent();},draw:function(){this.parent();},});});

// lib/game/entities/logic/man.js
ig.baked=true;ig.module('game.entities.logic.man').requires('impact.entity','game.entities.finalData').defines(function(){EntityMan=ig.Entity.extend({type:ig.Entity.TYPE.NONE,checkAgainst:ig.Entity.TYPE.NONE,count:0,direction:0,number:0,state:0,timer:0,inState:false,price:0,m_ManWidth:0,m_manHeight:0,init:function(x,y,settings){this.parent(x,y,settings);this.maxVel.x=2000;this.maxVel.y=2000;this.m_ManWidth=40*FinalData.kScale;this.m_ManHeight=71*FinalData.kScale;if(this.count==1)
this.animSheet=new ig.AnimationSheet("media/man.png",this.m_ManWidth/FinalData.kScale,this.m_ManHeight/FinalData.kScale,FinalData.kScale);else
this.animSheet=new ig.AnimationSheet("media/girl.png",this.m_ManWidth/FinalData.kScale,this.m_ManHeight/FinalData.kScale,FinalData.kScale);this.addAnim('run',0.3,[0,1]);this.addAnim('stop',0.6,[2,3],true);this.currentAnim=this.anims.run;if(this.state==0){this.direction=Math.random();if(this.direction<0.5){this.pos.x=-(Math.random()*150*FinalData.kScale).toInt();this.currentAnim.flip.x=true;this.vel.x=300*FinalData.kScale+(Math.random()*100*FinalData.kScale).toInt();}else{this.pos.x=FinalData.SCREEN_WIDTH+(Math.random()*150*FinalData.kScale).toInt();this.currentAnim.flip.x=false;this.vel.x=-(300*FinalData.kScale+(Math.random()*100*FinalData.kScale).toInt());}}else{this.vel.y=400;}},update:function(){this.parent();if(ig.game.m_setup==FinalData.GAME_STEP){if(this.inState){this.vel.x=0;this.vel.y=0;this.pos.x=ig.game.eng.tower[this.number].pos.x+this.price;this.pos.y=ig.game.eng.tower[this.number].pos.y;if(this.timer<15){if(this.number==ig.game.eng.towerCount)
this.kill();this.timer++;}else{this.kill();}}else{if(this.state==0){if(this.number<=ig.game.eng.towerCount-1){if(this.pos.y<ig.game.eng.tower[this.number].pos.y){this.pos.y=ig.game.eng.tower[this.number].pos.y;}
if(this.direction<0.5){if(this.pos.x+this.m_ManWidth>=ig.game.eng.tower[this.number].pos.x+45*FinalData.kScale){ig.game.eng.arrManCount[ig.game.eng.towerCount-1]+=1;this.price=7*FinalData.kScale;this.currentAnim=this.anims.stop;this.inState=true;}}else{if(this.pos.x<=ig.game.eng.tower[this.number].pos.x+ig.game.eng.tower[this.number].size.x-45*FinalData.kScale){ig.game.eng.arrManCount[ig.game.eng.towerCount-1]+=1;this.price=50*FinalData.kScale;this.currentAnim=this.anims.stop;this.inState=true;}}}else{this.vel.x=100;this.vel.y=300;if(this.pos.y>FinalData.SCREEN_HEIGHT)
this.kill();}}else{if(this.pos.y>FinalData.SCREEN_HEIGHT)
this.kill();}}}else
this.kill();},kill:function(){this.parent();},draw:function(){this.currentAnim.draw(this.pos.x,this.pos.y);this.parent();},});});

// lib/game/entities/logic/effect.js
ig.baked=true;ig.module('game.entities.logic.effect').requires('impact.entity','impact.myimage','game.entities.finalData').defines(function(){EntityEffect=ig.Entity.extend({type:ig.Entity.TYPE.NONE,checkAgainst:ig.Entity.TYPE.NONE,index:0,count:0,imgBack:null,val:0,init:function(x,y,settings){this.parent(x,y,settings);this.imgBack=new ig.MyImage("media/effect.png");this.imgBack.setScale(FinalData.kScale);},update:function(){this.parent();if(this.count>=50){this.kill();}else{this.count++;if(this.index==0)
this.index=1;else this.index=0;}},kill:function(){this.parent();},draw:function(){this.parent();this.imgBack.drawTile(ig.game.eng.tower[this.val].pos.x,ig.game.eng.tower[this.val].pos.y,this.index,95*FinalData.kScale,77*FinalData.kScale);},});});

// lib/game/entities/logic/towerHeight.js
ig.baked=true;ig.module('game.entities.logic.towerHeight').requires('impact.entity','impact.myimage','game.entities.finalData').defines(function(){EntityTowerHeight=ig.Entity.extend({type:ig.Entity.TYPE.NONE,checkAgainst:ig.Entity.TYPE.NONE,imgBack:null,m_PosX:20,m_PosY:839,init:function(x,y,settings){this.parent(x,y,settings);this.imgBack=new ig.MyImage("media/so.png");this.imgBack.setScale(FinalData.kScale);this.m_PosX=x;this.m_PosY=y;this.pos.x=this.m_PosX*FinalData.kScale;this.pos.y=this.m_PosY*FinalData.kScale;},update:function(){this.parent();},kill:function(){this.parent();},draw:function(){this.parent();this.imgBack.draw(this.pos.x,this.pos.y);this.drawCenterString(70*FinalData.kScale,915*FinalData.kScale,ig.game.eng.towerCount,50*FinalData.kScale,"#ffffff");if(!ig.game.eng.dropManState&&ig.game.eng.towerCount>1)
ig.game.eng.drawCenterString(410*FinalData.kScale,50*FinalData.kScale,70*FinalData.kScale+"px Arial Bold",ig.game.eng.arrManCount[ig.game.eng.towerCount-1],"#FB0006","center");else
ig.game.eng.drawCenterString(410*FinalData.kScale,50*FinalData.kScale,70*FinalData.kScale+"px Arial Bold",-ig.game.eng.dropManCount,"#FB0006","center");},drawCenterString:function(x,y,str,size,color){ig.system.context.font=size*FinalData.kScale+"px Arial Bold";ig.system.context.textAlign='center';ig.system.context.textBaseline='middle';ig.system.context.fillStyle=color;ig.system.context.fillText(str,x,y);},});});

// lib/game/entities/logic/manCounter.js
ig.baked=true;ig.module('game.entities.logic.manCounter').requires('impact.entity','impact.myimage','game.entities.finalData').defines(function(){EntityManCounter=ig.Entity.extend({type:ig.Entity.TYPE.NONE,checkAgainst:ig.Entity.TYPE.NONE,imgBack:null,m_PosX:20,m_PosY:839,init:function(x,y,settings){this.parent(x,y,settings);this.imgBack=new ig.MyImage("media/so1.png");this.imgBack.setScale(FinalData.kScale);this.m_PosX=x;this.m_PosY=y;this.pos.x=this.m_PosX*FinalData.kScale;this.pos.y=this.m_PosY*FinalData.kScale;},update:function(){this.parent();},kill:function(){this.parent();},draw:function(){this.parent();this.imgBack.draw(this.pos.x,this.pos.y);var currentPopulation=0;for(i=0;i<ig.game.eng.towerCount;i++){currentPopulation+=ig.game.eng.arrManCount[i];}
this.drawCenterString(550*FinalData.kScale,915*FinalData.kScale,currentPopulation,50*FinalData.kScale,"#ffffff");},drawCenterString:function(x,y,str,size,color){ig.system.context.font=size*FinalData.kScale+"px Arial Bold";ig.system.context.textAlign='center';ig.system.context.textBaseline='middle';ig.system.context.fillStyle=color;ig.system.context.fillText(str,x,y);},});});

// lib/game/entities/logic/dropCharacter.js
ig.baked=true;ig.module('game.entities.logic.dropCharacter').requires('impact.entity','game.entities.finalData').defines(function(){EntityDrop=ig.Entity.extend({type:ig.Entity.TYPE.NONE,checkAgainst:ig.Entity.TYPE.NONE,strCharacter:["media/charac_2.png","media/charac_3.png","media/charac_4.png","media/charac_5.png"],strRoof:["media/roof_1.png","media/roof_2.png","media/roof_3.png","media/roof_4.png"],count:0,radian:0,direction:"",step:0,index:0,init:function(x,y,settings){this.parent(x,y,settings);this.size.x=this.width;this.size.y=this.height;this.maxVel.y=2000;this.accel.y=1000;this.vel.y=300*FinalData.kScale;if(this.index==0||this.index==2){if(ig.game.buildTower==10){this.animSheet=new ig.AnimationSheet(this.strCharacter[0],this.size.x/FinalData.kScale,this.size.y/FinalData.kScale,FinalData.kScale);}else if(ig.game.buildTower==20){this.animSheet=new ig.AnimationSheet(this.strCharacter[1],this.size.x/FinalData.kScale,this.size.y/FinalData.kScale,FinalData.kScale);}else if(ig.game.buildTower==30){this.animSheet=new ig.AnimationSheet(this.strCharacter[2],this.size.x/FinalData.kScale,this.size.y/FinalData.kScale,FinalData.kScale);}else if(ig.game.buildTower==40){this.animSheet=new ig.AnimationSheet(this.strCharacter[3],this.size.x/FinalData.kScale,this.size.y/FinalData.kScale,FinalData.kScale);}else{this.animSheet=new ig.AnimationSheet(this.strCharacter[0],this.size.x/FinalData.kScale,this.size.y/FinalData.kScale,FinalData.kScale);}}else if(this.index==3){if(ig.game.buildTower==10){this.animSheet=new ig.AnimationSheet(this.strRoof[0],this.size.x/FinalData.kScale,this.size.y/FinalData.kScale,FinalData.kScale);}else if(ig.game.buildTower==20){this.animSheet=new ig.AnimationSheet(this.strRoof[1],this.size.x/FinalData.kScale,this.size.y/FinalData.kScale,FinalData.kScale);}else if(ig.game.buildTower==30){this.animSheet=new ig.AnimationSheet(this.strRoof[2],this.size.x/FinalData.kScale,this.size.y/FinalData.kScale,FinalData.kScale);}else if(ig.game.buildTower==40){this.animSheet=new ig.AnimationSheet(this.strRoof[3],this.size.x/FinalData.kScale,this.size.y/FinalData.kScale,FinalData.kScale);}}
this.addAnim('drop',0.2,[0]);this.currentAnim=this.anims.drop;this.step=Math.random()*Math.PI/12;},update:function(){this.parent();if(this.radian>2*Math.PI){this.radian=0;}else{if(this.direction=="left"){this.radian-=this.step;}else if(this.direction=="right"){this.radian+=this.step;}}
this.currentAnim.angle=this.radian;},kill:function(){this.parent();if(this.pos.y>FinalData.SCREEN_HEIGHT)
this.kill();},draw:function(){this.currentAnim.draw(this.pos.x,this.pos.y);this.parent();},});});

// lib/game/entities/logic/cloud.js
ig.baked=true;ig.module('game.entities.logic.cloud').requires('impact.entity','impact.image','game.entities.finalData').defines(function(){EntityCloud=ig.Entity.extend({type:ig.Entity.TYPE.NONE,checkAgainst:ig.Entity.TYPE.NONE,m_CloudWidth:0,m_CloudHeight:0,count:0,state:false,set:false,anim:null,init:function(x,y,settings){this.parent(x,y,settings);this.m_CloudWidth=190*FinalData.kScale;this.m_CloudHeight=112*FinalData.kScale;this.size.x=this.m_CloudWidth;this.size.y=this.m_CloudHeight;this.animSheet=new ig.AnimationSheet("media/cloud.png",this.size.x/FinalData.kScale,this.size.y/FinalData.kScale,FinalData.kScale);this.addAnim('run',0.2,[0]);this.currentAnim=this.anims.run;this.maxVel.x=2000;if(Math.random()<0.5){this.vel.x=Math.random()*20*FinalData.kScale;this.pos.x=0;this.pos.y=-Math.random()*560*FinalData.kScale;}else{this.vel.x=-Math.random()*20;this.pos.x=FinalData.SCREEN_WIDTH;this.pos.y=-Math.random()*560*FinalData.kScale;}},update:function(){this.parent();if(this.pos.x+this.size.x<0||this.pos.x>FinalData.SCREEN_WIDTH||this.pos.y>FinalData.SCREEN_HEIGHT){ig.game.eng.cloudCount+=1;this.kill();}
if(ig.game.eng.dropState){this.pos.y+=ig.game.eng.step;}
if(ig.game.eng.upState){this.pos.y-=ig.game.eng.step;}},kill:function(){this.parent();},draw:function(){this.parent();this.currentAnim.draw(this.pos.x,this.pos.y);},});});

// lib/game/entities/logic/eGame.js
ig.baked=true;ig.module('game.entities.logic.eGame').requires('impact.entity','impact.myimage','game.entities.score','game.entities.logic.button','game.entities.logic.line','game.entities.logic.character','game.entities.logic.tower','game.entities.logic.side','game.entities.logic.man','game.entities.logic.effect','game.entities.logic.towerHeight','game.entities.logic.manCounter','game.entities.logic.dropCharacter','game.entities.logic.cloud','game.entities.finalData').defines(function(){EintityGame=ig.Entity.extend({imgBack:null,bMenu:null,bScore:null,line:null,character:null,tower:[],side:null,score:null,gameover:null,towerHeight:null,population:null,oneTower:null,twoTower:null,cloud:[],arrManCount:[],backHeight:0,m_BackHeight:1024,towerCount:0,step:0,upState:false,dropState:false,scoreState:false,moveCount:0,manCount:0,spin:1,backScale:1.220703125,alpha:0,stopState:false,towerRadianStep:0,gameoverState:false,dropCount:0,dropManCount:0,cloudCount:0,totalTower:0,gameState:"game",init:function(x,y,settings){this.parent(x,y,settings);ig.game.clearColor='#66CCFF';for(i=0;i<1000;i++){this.arrManCount[i]=0;}
this.imgBack=new ig.MyImage("media/back.png");this.imgBack.setScale(FinalData.kScale);this.backHeight=FinalData.SCREEN_HEIGHT-this.m_BackHeight*FinalData.kScale;this.step=81*FinalData.kScale/10;this.towerRadianStep=Math.random()*Math.PI/2000;},getTowerRadian:function(){if(this.towerCount>0){this.side.pos.x=this.tower[this.towerCount-1].pos.x;}
if(this.alpha>=Math.PI/100){this.spin=-1;}else if(this.alpha<=-Math.PI/100){this.spin=1;}
this.alpha+=this.spin*this.towerRadianStep;},formatEntity:function(){this.bMenu.kill();if(ig.game.quickState)
this.bScore.kill();this.line.kill();if(this.character!=null)
this.character.kill();this.side.kill();for(i=0;i<this.towerCount;i++){this.tower[i].kill();}
for(i=0;i<5;i++){if(this.cloud[i]!=null)
this.cloud[i].kill();}
this.towerHeight.kill();this.population.kill();},createEntity:function(){this.bMenu=ig.game.spawnEntity(EntityButton,0,0,{name:'menu'});if(ig.game.quickState)
this.bScore=ig.game.spawnEntity(EntityButton,0,0,{name:'score'});this.line=ig.game.spawnEntity(EntityLine,0,0);this.character=ig.game.spawnEntity(EntityCharacter,0,0,{index:1});this.side=ig.game.spawnEntity(EntitySide,0,952*FinalData.kScale,{width:FinalData.SCREEN_WIDTH,height:30*FinalData.kScale,index:0});this.towerHeight=ig.game.spawnEntity(EntityTowerHeight,20,839);this.population=ig.game.spawnEntity(EntityManCounter,500,839);this.createCloud();},createCloud:function(){for(i=0;i<5;i++){this.cloud[i]=ig.game.spawnEntity(EntityCloud,0,0);}},createMan:function(){for(i=0;i<this.manCount;i++){var manState=(Math.random()*2).toInt();var man=ig.game.spawnEntity(EntityMan,0,this.tower[this.towerCount].pos.y,{count:manState,number:this.towerCount,state:0});man.zIndex=10;ig.game.sortEntities();}},createTower:function(){var posX=this.character.pos.x;if(this.towerCount==0)
var posY=this.character.pos.y;else
var posY=this.tower[this.towerCount-1].pos.y-this.character.size.y;var posW=this.character.size.x;var posH=this.character.size.y;this.side.size.x=posW;this.side.size.y=posH;this.tower[this.towerCount]=ig.game.spawnEntity(EntityTower,posX,posY,{width:posW,height:posH,index:this.character.index,count:this.towerCount});this.side.pos.x=this.tower[this.towerCount].pos.x;this.side.pos.y=this.tower[this.towerCount].pos.y;this.character.kill();this.character=null;if(this.towerCount>0)
this.createMan();if(this.towerCount>2)
this.dropState=true;this.dropManState=false;this.towerCount++;},orderByEntity:function(){this.bMenu.zIndex=this.zIndex+8;if(ig.game.quickState)
this.bScore.zIndex=this.zIndex+8;this.line.zIndex=this.zIndex+3;if(this.character!=null)
this.character.zIndex=this.zIndex+3;for(i=0;i<this.towerCount;i++)
this.tower[i].zIndex=this.zIndex+2;if(this.oneTower!=null)this.oneTower.zIndex=this.zIndex+2;if(this.twoTower!=null)this.twoTower.zIndex=this.zIndex+2;if(this.score!=null)
this.score.zIndex=this.zIndex+4;if(this.gameover!=null)
this.gameover.zIndex=this.zIndex+4;this.towerHeight.zIndex=this.zIndex+11;this.population.zIndex=this.zIndex+11;for(i=0;i<5;i++){if(this.cloud[i]!=null)
this.cloud[i].zIndex=this.zIndex+1;}
ig.game.sortEntities();},checkPos:function(){if(this.character.index==1){return true;}else{if(this.character.pos.x+this.character.size.x/2>=this.side.pos.x&&this.character.pos.x<=this.side.pos.x+this.side.size.x/2){var cX=this.character.pos.x+this.character.size.x/2;var tX=this.tower[this.towerCount-1].pos.x+this.tower[this.towerCount-1].size.x/2;if(cX>=tX-4*FinalData.kScale&&cX<=tX+4*FinalData.kScale){if(ig.game.buildTower>0&&this.towerCount==ig.game.buildTower-1){this.manCount=0;}else{this.manCount=4;var effect=ig.game.spawnEntity(EntityEffect,0,0,{val:this.towerCount});effect.zIndex=this.zIndex+3;}}else if(cX>=tX+4*FinalData.kScale&&cX<=tX+10*FinalData.kScale||cX<=tX-4*FinalData.kScale&&cX>=tX-10*FinalData.kScale){if(ig.game.buildTower>0&&this.towerCount==ig.game.buildTower-1){this.manCount=0;}else this.manCount=3;}else{if(ig.game.buildTower>0&&this.towerCount==ig.game.buildTower-1){this.manCount=0;}else
this.manCount=(1+Math.random()*2).toInt();}
return true;}else{return false;}
ig.game.sortEntities();}},dropCharacter:function(){var direction;if(this.character.pos.x+this.character.size.x/2<this.tower[this.towerCount-1].pos.x){direction="left";}else if(this.character.pos.x>this.tower[this.towerCount-1].pos.x+this.tower[this.towerCount-1].size.x/2){direction="right";}
if(this.towerCount==1){this.oneTower=ig.game.spawnEntity(EntityDrop,this.character.pos.x,this.character.pos.y,{direction:direction,width:this.character.size.x,height:this.character.size.y,index:this.character.index});}else{this.oneTower=ig.game.spawnEntity(EntityDrop,this.character.pos.x,this.character.pos.y,{direction:direction,width:this.character.size.x,height:this.character.size.y,index:this.character.index});if(Math.random()>0.5)direction="left";else direction="right";this.twoTower=ig.game.spawnEntity(EntityDrop,this.tower[this.towerCount-1].pos.x,this.tower[this.towerCount-1].pos.y,{direction:direction,width:this.tower[this.towerCount-1].size.x,height:this.tower[this.towerCount-1].size.y});for(i=0;i<this.arrManCount[this.towerCount-1];i++){var man=ig.game.spawnEntity(EntityMan,this.tower[this.towerCount-1].pos.x,this.tower[this.towerCount-1].pos.y+Math.random()*50,{count:0,number:(this.towerCount-1),state:1});man.zIndex=10;}
this.tower[this.towerCount-1].kill();if(this.towerCount>3){this.upState=true;}
this.dropManCount=this.arrManCount[this.towerCount-1];this.arrManCount[this.towerCount-1]=0;this.towerCount-=1;this.side.pos.x=this.tower[this.towerCount-1].pos.x;this.side.pos.y=this.tower[this.towerCount-1].pos.y;this.dropManState=true;}
this.character.kill();this.character=null;this.dropCount++;},moveDropBack:function(){if(this.moveCount<10){this.backHeight+=this.step;this.side.pos.y+=this.step;this.moveCount++;for(i=0;i<this.towerCount;i++)
this.tower[i].pos.y+=this.step;}else{this.dropState=false;this.moveCount=0;}},moveUpBack:function(){if(this.moveCount<10){this.backHeight-=this.step;this.side.pos.y-=this.step;this.moveCount++;for(i=0;i<this.towerCount;i++){this.tower[i].pos.y-=this.step;}}else{this.upState=false;this.moveCount=0;}},buildMove:function(){this.backHeight-=this.step;for(i=0;i<this.towerCount;i++){this.tower[i].pos.y-=this.step;}
for(i=0;i<5;i++){if(this.cloud[i]!=null)
this.cloud[i].pos.y-=this.step;}},keyCheck:function(){switch(this.gameState){case"game":this.keyCheckGame();break;case"score":this.keyCheckScore();break;case"finish":this.keyCheckFinish();break;}},keyCheckGame:function(){if(ig.input.pressed('mouse')){var x=ig.input.mouse.x;var y=ig.input.mouse.y;if(x>=this.bMenu.m_posX&&x<=this.bMenu.m_posX+this.bMenu.m_posWidth&&y>=this.bMenu.m_posY&&y<=this.bMenu.m_posY+this.bMenu.m_posHeight){this.formatEntity();ig.game.gotoStep(FinalData.MAINMENU_STEP);}else if(ig.game.quickState&&x>=this.bScore.m_posX&&x<=this.bScore.m_posX+this.bScore.m_posWidth&&y>=this.bScore.m_posY&&y<=this.bScore.m_posY+this.bScore.m_posHeight){this.gameState="score";this.score=ig.game.spawnEntity(EntityScore,0,0,{name:"score"});}else{this.character.state=true;}}},keyCheckScore:function(){if(ig.input.pressed('mouse')){var x=ig.input.mouse.x;var y=ig.input.mouse.y;if(x>=this.score.m_BtnX&&x<=this.score.m_BtnX+this.score.m_BtnWidth&&y>=this.score.m_BtnY&&y<=this.score.m_BtnY+this.score.m_BtnHeight){this.score.kill();this.score=null;if(this.gameoverState){this.formatEntity();ig.game.gotoStep(FinalData.MAINMENU_STEP);}else{this.gameState="game";}}}},keyCheckFinish:function(){if(ig.input.pressed('mouse')){var x=ig.input.mouse.x;var y=ig.input.mouse.y;if(x>=this.gameover.m_BtnX&&x<=this.gameover.m_BtnX+this.gameover.m_BtnWidth&&y>=this.gameover.m_BtnY&&y<=this.gameover.m_BtnY+this.gameover.m_BtnHeight){if(ig.game.quickState){if(ig.game.m_ScoreCount>9)
ig.game.m_ScoreCount=0;ig.game.score_TowerHeight[ig.game.m_ScoreCount]=this.towerCount;ig.game.m_ScoreCount++;}
this.gameover.kill();this.gameover=null;if(ig.game.quickState){this.gameState="score";this.score=ig.game.spawnEntity(EntityScore,0,0,{name:"score"});}else{ig.game.currentTowerCount=this.towerCount;for(i=0;i<this.towerCount;i++){ig.game.currentPopualtion+=this.arrManCount[i];}
this.formatEntity();ig.game.gotoStep(FinalData.BUILD_MAINMENU_STEP);}}}},checkEntity:function(){if(this.dropCount>=3){this.gameoverState=true;this.gameState="finish";this.gameover=ig.game.spawnEntity(EntityScore,0,0,{name:"gameover"});}
if(this.cloudCount>=5){this.cloudCount=0;this.createCloud();}
if(this.side.coll_state){if(this.checkPos()){this.createTower();}else
this.dropCharacter();if(ig.game.buildTower>0){if(this.towerCount<ig.game.buildTower-1)
this.character=ig.game.spawnEntity(EntityCharacter,0,0,{index:2});else if(this.towerCount==ig.game.buildTower-1)
this.character=ig.game.spawnEntity(EntityCharacter,0,0,{index:3});}else{this.character=ig.game.spawnEntity(EntityCharacter,0,0,{index:2});}
this.side.coll_state=false;}else if(this.character!=null&&this.character.pos.y>=FinalData.SCREEN_HEIGHT){this.dropCount++;this.character.kill();this.character=null;if(ig.game.buildTower>0){if(this.towerCount<ig.game.buildTower-1)
this.character=ig.game.spawnEntity(EntityCharacter,0,0,{index:2});else if(this.towerCount==ig.game.buildTower-1)
this.character=ig.game.spawnEntity(EntityCharacter,0,0,{index:3});}else{this.character=ig.game.spawnEntity(EntityCharacter,0,0,{index:2});}}
if(this.upState)
this.moveUpBack();if(this.dropState)
this.moveDropBack();},update:function(){this.parent();this.keyCheck();switch(this.gameState){case"game":if(ig.game.buildTower==0)
this.checkEntity();else if(ig.game.buildTower>0&&this.towerCount<ig.game.buildTower)
this.checkEntity();else{this.dropState=false;this.upState=false;if(this.backHeight>FinalData.SCREEN_HEIGHT-this.m_BackHeight*FinalData.kScale)
this.buildMove();else{this.gameoverState=true;this.gameState="finish";this.gameover=ig.game.spawnEntity(EntityScore,0,0,{name:"gameover"});}}
break;case"score":this.dropState=false;this.upState=false;break;case"finish":this.dropState=false;this.upState=false;break;}
if(this.towerCount>5)this.getTowerRadian();this.orderByEntity();},drawCenterString:function(x,y,size,str,color,align){ig.system.context.font=size;ig.system.context.textAlign=align;ig.system.context.textBaseline='middle';ig.system.context.fillStyle=color;ig.system.context.fillText(str,x,y);},draw:function(){this.parent();this.imgBack.draw(0,this.backHeight);},kill:function(){this.parent();},});});

// lib/game/entities/logo.js
ig.baked=true;ig.module('game.entities.logo').requires('impact.entity','impact.myimage','game.entities.finalData').defines(function(){EntityLogo=ig.Entity.extend({imgBack:null,count:0,init:function(x,y,settings){this.parent(x,y,settings);this.imgBack=new ig.MyImage("media/title.png");this.imgBack.setScale(FinalData.kScale);},keyCheck:function(){if(ig.input.pressed('mouse')){ig.game.gotoStep(FinalData.MAINMENU_STEP);}},update:function(){this.parent();if(this.count>=30){ig.game.gotoStep(FinalData.MAINMENU_STEP);}else{this.count++;}},draw:function(){this.parent();this.imgBack.draw(0,0);},kill:function(){this.parent();},});});

// lib/game/main.js
ig.baked=true;ig.module('game.main').requires('impact.game','game.entities.finalData','game.entities.mainmenu','game.entities.logic.eGame','game.entities.logo').defines(function(){MyGame=ig.Game.extend({eng:null,m_setup:0,quickState:false,soundCount:0,m_ScoreCount:0,score_TowerHeight:[],currentTowerCount:0,currentPopualtion:0,totalPopualtion:0,totalTowerHeight:0,towerCount:1,buildTower:0,scaleCount:0,arr_Popualtion:[[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0]],arr_Tower:[[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0]],currentTower:[[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0]],lineTower:[[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0]],init:function(){if(ig.ua.android){FinalData.kScale=window.innerWidth/640;window.scrollTo(0,8);}else{this.scaleCount=1;setTimeout(function(){window.scrollTo(0,0);},1);}
ig.input.bind(ig.KEY.MOUSE1,'mouse');for(i=0;i<10;i++)
this.score_TowerHeight[i]=0;},gotoStep:function(nStep){if(this.eng!=null){this.eng.kill();}
switch(nStep){case FinalData.LOGO_STEP:this.eng=this.spawnEntity(EntityLogo,0,0);break;case FinalData.MAINMENU_STEP:this.eng=this.spawnEntity(EntityMainMenu,0,0);break;case FinalData.BUILD_MAINMENU_STEP:this.eng=this.spawnEntity(EntityBuildMenu,0,0);break;case FinalData.GAME_STEP:this.eng=this.spawnEntity(EintityGame,0,0);this.eng.createEntity();break;};this.m_setup=nStep;},update:function(){if(this.scaleCount==0){FinalData.kScale=window.innerWidth/640;this.scaleCount++;}
this.parent();if(!this.bStart){this.gotoStep(FinalData.LOGO_STEP);this.bStart=true;}},draw:function(){this.parent();},});MyLoader=ig.Loader.extend({load:function(){this.parent();},});ig.main('#canvas',MyGame,FinalData.FRAMETIME,FinalData.SCREEN_WIDTH,FinalData.SCREEN_HEIGHT,1,MyLoader);});